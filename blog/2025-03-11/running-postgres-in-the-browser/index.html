<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta data-react-helmet="true" name="twitter:description" content="I&#x27;ve been playing around with PGlite, and it&#x27;s pretty cool. There are some gotchas, so I&#x27;ll run through how I got PGlite running with Vite and Drizzle. There&#x27;s a working demo and GitHub repo at the end too."/><meta data-react-helmet="true" name="twitter:title" content="Running Postgres 100% in the browser with PGlite and Drizzle"/><meta data-react-helmet="true" name="twitter:creator" content="AdrianLThomas"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:description" content="I&#x27;ve been playing around with PGlite, and it&#x27;s pretty cool. There are some gotchas, so I&#x27;ll run through how I got PGlite running with Vite and Drizzle. There&#x27;s a working demo and GitHub repo at the end too."/><meta data-react-helmet="true" property="og:title" content="Running Postgres 100% in the browser with PGlite and Drizzle"/><meta data-react-helmet="true" name="description" content="I&#x27;ve been playing around with PGlite, and it&#x27;s pretty cool. There are some gotchas, so I&#x27;ll run through how I got PGlite running with Vite and Drizzle. There&#x27;s a working demo and GitHub repo at the end too."/><meta name="theme-color" content="#1e90ff"/><meta name="generator" content="Gatsby 4.11.1"/><style data-href="/styles.c442fa217b1b07d5ca56.css" data-identity="gatsby-global-css">@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-8d7d79679b70dbe27172b6460e7a7910.woff2) format("woff2"),url(/static/montserrat-latin-100-ec38980a9e0119a379e2a9b3dbb1901a.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-e279051046ba1286706adc886cf1c96b.woff2) format("woff2"),url(/static/montserrat-latin-100italic-3b325a3173c8207435cd1b76e19bf501.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-9d266fbbfa6cab7009bd56003b1eeb67.woff2) format("woff2"),url(/static/montserrat-latin-200-2d8ba08717110d27122e54c34b8a5798.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-6e5b3756583bb2263eb062eae992735e.woff2) format("woff2"),url(/static/montserrat-latin-200italic-a0d6f343e4b536c582926255367a57da.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-00b3e893aab5a8fd632d6342eb72551a.woff2) format("woff2"),url(/static/montserrat-latin-300-ea303695ceab35f17e7d062f30e0173b.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-56f34ea368f6aedf89583d444bbcb227.woff2) format("woff2"),url(/static/montserrat-latin-300italic-54b0bf2c8c4c12ffafd803be2466a790.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-b71748ae4f80ec8c014def4c5fa8688b.woff2) format("woff2"),url(/static/montserrat-latin-400-0659a9f4e90db5cf51b50d005bff1e41.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-6eed6b4cbb809c6efc7aa7ddad6dbe3e.woff2) format("woff2"),url(/static/montserrat-latin-400italic-7583622cfde30ae49086d18447ab28e7.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-091b209546e16313fd4f4fc36090c757.woff2) format("woff2"),url(/static/montserrat-latin-500-edd311588712a96bbf435fad264fff62.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-c90ced68b46050061d1a41842d6dfb43.woff2) format("woff2"),url(/static/montserrat-latin-500italic-5146cbfe02b1deea5dffea27a5f2f998.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-0480d2f8a71f38db8633b84d8722e0c2.woff2) format("woff2"),url(/static/montserrat-latin-600-b77863a375260a05dd13f86a1cee598f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-cf46ffb11f3a60d7df0567f8851a1d00.woff2) format("woff2"),url(/static/montserrat-latin-600italic-c4fcfeeb057724724097167e57bd7801.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-7dbcc8a5ea2289d83f657c25b4be6193.woff2) format("woff2"),url(/static/montserrat-latin-700-99271a835e1cae8c76ef8bba99a8cc4e.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-c41ad6bdb4bd504a843d546d0a47958d.woff2) format("woff2"),url(/static/montserrat-latin-700italic-6779372f04095051c62ed36bc1dcc142.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-db9a3e0ba7eaea32e5f55328ace6cf23.woff2) format("woff2"),url(/static/montserrat-latin-800-4e3c615967a2360f5db87d2f0fd2456f.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-bf45bfa14805969eda318973947bc42b.woff2) format("woff2"),url(/static/montserrat-latin-800italic-fe82abb0bcede51bf724254878e0c374.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:normal;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-e66c7edc609e24bacbb705175669d814.woff2) format("woff2"),url(/static/montserrat-latin-900-8211f418baeb8ec880b80ba3c682f957.woff) format("woff")}@font-face{font-display:swap;font-family:Montserrat;font-style:italic;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-4454c775e48152c1a72510ceed3603e2.woff2) format("woff2"),url(/static/montserrat-latin-900italic-efcaa0f6a82ee0640b83a0916e6e8d68.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-fc117160c69a8ea0851b26dd14748ee4.woff2) format("woff2"),url(/static/merriweather-latin-300-58b18067ebbd21fda77b67e73c241d3b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-fe29961474f8dbf77c0aa7b9a629e4bc.woff2) format("woff2"),url(/static/merriweather-latin-300italic-23c3f1f88683618a4fb8d265d33d383a.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-d9479e8023bef9cbd9bf8d6eabd6bf36.woff2) format("woff2"),url(/static/merriweather-latin-400-040426f99ff6e00b86506452e0d1f10b.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-2de7bfeaf08fb03d4315d49947f062f7.woff2) format("woff2"),url(/static/merriweather-latin-400italic-79db67aca65f5285964ab332bd65f451.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-4b08e01d805fa35d7bf777f1b24314ae.woff2) format("woff2"),url(/static/merriweather-latin-700-22fb8afba4ab1f093b6ef9e28a9b6e92.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-cd92541b177652fffb6e3b952f1c33f1.woff2) format("woff2"),url(/static/merriweather-latin-700italic-f87f3d87cea0dd0979bfc8ac9ea90243.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:normal;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-f813fc6a4bee46eda5224ac7ebf1b7be.woff2) format("woff2"),url(/static/merriweather-latin-900-5d4e42cb44410674acd99153d57df032.woff) format("woff")}@font-face{font-display:swap;font-family:Merriweather;font-style:italic;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-b7901d85486871c1779c0e93ddd85656.woff2) format("woff2"),url(/static/merriweather-latin-900italic-9647f9fdab98756989a8a5550eb205c3.woff) format("woff")}


/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden]{display:none}:root{--maxWidth-none:"none";--maxWidth-xs:20rem;--maxWidth-sm:24rem;--maxWidth-md:28rem;--maxWidth-lg:32rem;--maxWidth-xl:36rem;--maxWidth-2xl:42rem;--maxWidth-3xl:48rem;--maxWidth-4xl:56rem;--maxWidth-full:"100%";--maxWidth-wrapper:var(--maxWidth-4xl);--spacing-px:"1px";--spacing-0:0;--spacing-1:0.25rem;--spacing-2:0.5rem;--spacing-3:0.75rem;--spacing-4:1rem;--spacing-5:1.25rem;--spacing-6:1.5rem;--spacing-8:2rem;--spacing-10:2.5rem;--spacing-12:3rem;--spacing-16:4rem;--spacing-20:5rem;--spacing-24:6rem;--spacing-32:8rem;--fontFamily-sans:"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";--fontFamily-serif:"Merriweather","Georgia",Cambria,"Times New Roman",Times,serif;--font-body:var(--fontFamily-serif);--font-heading:var(--fontFamily-sans);--fontWeight-normal:400;--fontWeight-medium:500;--fontWeight-semibold:600;--fontWeight-bold:700;--fontWeight-extrabold:800;--fontWeight-black:900;--fontSize-root:16px;--lineHeight-none:1;--lineHeight-tight:1.1;--lineHeight-normal:1.5;--lineHeight-relaxed:1.625;--fontSize-0:0.833rem;--fontSize-1:1rem;--fontSize-2:1.2rem;--fontSize-3:1.44rem;--fontSize-4:1.728rem;--fontSize-5:2.074rem;--fontSize-6:2.488rem;--fontSize-7:2.986rem;--color-primary:#005b99;--color-text:#2e353f;--color-text-light:#4f5969;--color-heading:#1a202c;--color-heading-black:#000;--color-accent:#d1dce5}*,:after,:before{box-sizing:border-box}html{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;font-size:var(--fontSize-root);line-height:var(--lineHeight-normal)}body{color:var(--color-text);font-family:var(--font-body);font-size:var(--fontSize-1)}footer{padding:var(--spacing-6) var(--spacing-0)}hr{background:var(--color-accent);border:0;height:1px}h1,h2,h3,h4,h5,h6{font-family:var(--font-heading);letter-spacing:-.025em;line-height:var(--lineHeight-tight);margin-bottom:var(--spacing-6);margin-top:0}h2,h3,h4,h5,h6{color:var(--color-heading);font-weight:var(--fontWeight-bold)}h1{color:var(--color-heading-black);font-size:var(--fontSize-6)}h2{font-size:var(--fontSize-5)}h3{font-size:var(--fontSize-4)}h4{font-size:var(--fontSize-3)}h5{font-size:var(--fontSize-2)}h6{font-size:var(--fontSize-1)}h1>a,h2>a,h3>a,h4>a,h5>a,h6>a{color:inherit;text-decoration:none}p{--baseline-multiplier:0.179;--x-height-multiplier:0.35;line-height:var(--lineHeight-relaxed);margin:var(--spacing-0) var(--spacing-0) var(--spacing-8) var(--spacing-0)}ol,p,ul{padding:var(--spacing-0)}ol,ul{list-style-image:none;list-style-position:outside;margin-bottom:var(--spacing-8);margin-left:var(--spacing-0);margin-right:var(--spacing-0)}ol li,ul li{padding-left:var(--spacing-0)}li>p,ol li,ul li{margin-bottom:calc(var(--spacing-8)/2)}li :last-child{margin-bottom:var(--spacing-0)}li>ul{margin-left:var(--spacing-8);margin-top:calc(var(--spacing-8)/2)}blockquote{border-left:var(--spacing-1) solid var(--color-primary);color:var(--color-text-light);font-size:var(--fontSize-2);font-style:italic;margin-bottom:var(--spacing-8);margin-left:calc(var(--spacing-6)*-1);margin-right:var(--spacing-8);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-6)}blockquote>:last-child{margin-bottom:var(--spacing-0)}blockquote>ol,blockquote>ul{list-style-position:inside}table{border-collapse:collapse;border-spacing:.25rem;margin-bottom:var(--spacing-8);width:100%}table thead tr th{border-bottom:1px solid var(--color-accent)}a{color:var(--color-primary)}a:focus,a:hover{text-decoration:none}.global-wrapper{margin:var(--spacing-0) auto;max-width:var(--maxWidth-wrapper);padding:0 var(--spacing-5) var(--spacing-10)}.global-wrapper[data-is-root-path=true] .bio{margin-bottom:var(--spacing-20)}.global-header{margin-bottom:var(--spacing-12)}.post-list-item{margin-bottom:var(--spacing-8);margin-top:var(--spacing-8)}.post-list-item p{margin-bottom:var(--spacing-0)}.post-list-item h2{color:var(--color-primary);font-size:var(--fontSize-4);margin-bottom:var(--spacing-2);margin-top:var(--spacing-0)}.post-list-item header{margin-bottom:var(--spacing-4)}.header-link-home{font-family:var(--font-heading);font-size:var(--fontSize-2);font-weight:var(--fontWeight-bold);text-decoration:none}.blog-post header h1{margin:var(--spacing-0) var(--spacing-0) var(--spacing-4) var(--spacing-0)}.blog-post header p{font-family:var(--font-heading);font-size:var(--fontSize-2)}.blog-post-nav ul{margin:var(--spacing-0)}.gatsby-highlight{margin-bottom:var(--spacing-8)}@media (max-width:42rem){blockquote{margin-left:var(--spacing-0);padding:var(--spacing-0) var(--spacing-0) var(--spacing-0) var(--spacing-4)}ol,ul{list-style-position:inside}}#___gatsby,#gatsby-focus-wrapper,body,html{height:100%}.global-wrapper{width:100%}code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#000;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-o-tab-size:4;tab-size:4;text-align:left;text-shadow:0 1px #fff;white-space:pre;word-break:normal;word-spacing:normal}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#b3d4fc;text-shadow:none}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{background:hsla(0,0%,100%,.5);color:#9a6e3a}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper picture.object-fit-polyfill{position:static!important}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preconnect" href="https://www.googletagmanager.com"/><link rel="dns-prefetch" href="https://www.googletagmanager.com"/><link rel="alternate" type="application/rss+xml" title="Adrian L Thomas" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=cc1665620e0dfea62da155c249953bf0" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=cc1665620e0dfea62da155c249953bf0"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=cc1665620e0dfea62da155c249953bf0"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=cc1665620e0dfea62da155c249953bf0"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=cc1665620e0dfea62da155c249953bf0"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=cc1665620e0dfea62da155c249953bf0"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=cc1665620e0dfea62da155c249953bf0"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=cc1665620e0dfea62da155c249953bf0"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=cc1665620e0dfea62da155c249953bf0"/><title data-react-helmet="true">Running Postgres 100% in the browser with PGlite and Drizzle | Adrian L Thomas</title><style data-styled="" data-styled-version="5.3.5">.iUnJFe{background-color:#1a202c;opacity:1;background-image:linear-gradient(30deg,#1d2e51 12%,transparent 12.5%,transparent 87%,#1d2e51 87.5%,#1d2e51),linear-gradient(150deg,#1d2e51 12%,transparent 12.5%,transparent 87%,#1d2e51 87.5%,#1d2e51),linear-gradient(30deg,#1d2e51 12%,transparent 12.5%,transparent 87%,#1d2e51 87.5%,#1d2e51),linear-gradient(150deg,#1d2e51 12%,transparent 12.5%,transparent 87%,#1d2e51 87.5%,#1d2e51),linear-gradient(60deg,#1d2e5177 25%,transparent 25.5%,transparent 75%,#1d2e5177 75%,#1d2e5177),linear-gradient(60deg,#1d2e5177 25%,transparent 25.5%,transparent 75%,#1d2e5177 75%,#1d2e5177);background-size:24px 42px;background-position:0 0,0 0,12px 21px,12px 21px,0 0,12px 21px;width:100%;min-height:150px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-bottom:0.5rem solid dodgerblue;padding:15px;}/*!sc*/
.iUnJFe h1,.iUnJFe p{color:white;}/*!sc*/
.iUnJFe h1{font-weight:bold;}/*!sc*/
.iUnJFe p{font-weight:lighter;margin:0;}/*!sc*/
.iUnJFe a{-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
data-styled.g1[id="hero__Container-sc-1ng29j0-0"]{content:"iUnJFe,"}/*!sc*/
.fVXSPP{background-color:#1a202c;opacity:1;background-image:linear-gradient(30deg,#1d2e51 12%,transparent 12.5%,transparent 87%,#1d2e51 87.5%,#1d2e51),linear-gradient(150deg,#1d2e51 12%,transparent 12.5%,transparent 87%,#1d2e51 87.5%,#1d2e51),linear-gradient(30deg,#1d2e51 12%,transparent 12.5%,transparent 87%,#1d2e51 87.5%,#1d2e51),linear-gradient(150deg,#1d2e51 12%,transparent 12.5%,transparent 87%,#1d2e51 87.5%,#1d2e51),linear-gradient(60deg,#1d2e5177 25%,transparent 25.5%,transparent 75%,#1d2e5177 75%,#1d2e5177),linear-gradient(60deg,#1d2e5177 25%,transparent 25.5%,transparent 75%,#1d2e5177 75%,#1d2e5177);background-size:24px 42px;background-position:0 0,0 0,12px 21px,12px 21px,0 0,12px 21px;width:100%;margin-top:auto;text-align:center;border-top:0.5rem solid dodgerblue;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;}/*!sc*/
.fVXSPP > *{margin-right:15px;}/*!sc*/
@media only screen and (max-width:500px){.fVXSPP > span{-webkit-flex-basis:500px;-ms-flex-preferred-size:500px;flex-basis:500px;}}/*!sc*/
.fVXSPP a,.fVXSPP span{color:white;}/*!sc*/
data-styled.g2[id="layout__Footer-sc-rvd8xs-0"]{content:"fVXSPP,"}/*!sc*/
.ehZYJV{height:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}/*!sc*/
.ehZYJV .global-wrapper{margin-top:18px;}/*!sc*/
data-styled.g3[id="layout__Wrapper-sc-rvd8xs-1"]{content:"ehZYJV,"}/*!sc*/
</style><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link as="script" rel="preload" href="/webpack-runtime-83d24ad685577667119e.js"/><link as="script" rel="preload" href="/framework-0613c9735af2d6569ef8.js"/><link as="script" rel="preload" href="/app-dad061e5f536956a6be2.js"/><link as="script" rel="preload" href="/commons-1d6544cb43ed1fc99bce.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-0b182b8b6135f0b205f7.js"/><link as="fetch" rel="preload" href="/page-data/blog/2025-03-11/running-postgres-in-the-browser/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2188205249.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/223224310.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/2441407101.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="layout__Wrapper-sc-rvd8xs-1 ehZYJV"><div class="hero__Container-sc-1ng29j0-0 iUnJFe"><a href="/blog"><h1>Adrian L Thomas</h1></a><p>Pizza, programming and cars - sometimes in that order.</p></div><div class="global-wrapper"><main><article class="blog-post" itemscope="" itemType="http://schema.org/Article"><header><h1 itemProp="headline">Running Postgres 100% in the browser with PGlite and Drizzle</h1><p>March 11, 2025</p></header><section itemProp="articleBody"><h1>tl;dr</h1>
<p>Iâ€™ve been playing around with <a href="https://pglite.dev/">PGlite</a> (<a href="https://www.postgresql.org/">Postgres</a> <a href="https://developer.mozilla.org/en-US/docs/WebAssembly">WASM</a>), and itâ€™s pretty cool. There are some gotchas, so Iâ€™ll run through how I got PGlite running with <a href="https://vite.dev/">Vite</a> (React) and <a href="https://orm.drizzle.team/">Drizzle</a> (ORM). Thereâ€™s a working <a href="http://www.adrian-thomas.com/pglite-spa">demo</a> and <a href="https://github.com/AdrianLThomas/pglite-spa">GitHub repo</a> at the end too.</p>
<h1>Getting setup</h1>
<p>Run the Vite scaffolder with your favourite package manager (Iâ€™ll continue to use Bun, but feel free to use npm/yarn/pnpm etc)</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">bun create vite</code></pre></div>
<p>and follow the steps to create a new React project.</p>
<p>You can then add PGlite:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">bun <span class="token function">add</span> @electric-sql/pglite</code></pre></div>
<h2>Gotcha #1 - Exclude PGlite from the bundle</h2>
<p>Some bundlers (like Vite and Next.js) struggle with PGlite, and it will error with something like:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Uncaught Error: Invalid FS bundle size: 723 !== 5401749</code></pre></div>
<p>so <a href="https://pglite.dev/docs/bundler-support#vite">exclude it from optimisation</a>:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// vite.config.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vite"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> react <span class="token keyword">from</span> <span class="token string">"@vitejs/plugin-react"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  optimizeDeps<span class="token operator">:</span> <span class="token punctuation">{</span>
    exclude<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@electric-sql/pglite"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2>PGlite 101</h2>
<p>Weâ€™re now in a position to make a Postgres query!</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">/// App.tsx</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> PGlite <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@electric-sql/pglite"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> drizzle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"drizzle-orm/pglite"</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PGlite</span><span class="token punctuation">(</span><span class="token string">"idb://my-pgdata"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token function">drizzle</span><span class="token punctuation">(</span><span class="token punctuation">{</span> client <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    db<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>
      <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select 1;</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span> sql <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token plain-text">Markup omitted for brevity...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></code></pre></div>
<p>Weâ€™re using <code class="language-text">idb://my-pgdata</code> when instantiating the client to use persistent browser storage. However there are also <a href="https://pglite.dev/docs/filesystems#filesystems">other storage options</a> available.</p>
<h2>Types, schema &#x26; migrations with Drizzle</h2>
<p>You can probably skip this part if you donâ€™t want / need to use an ORM and are happy with arbitrary SQL. However if youâ€™d like types and the ability to migrate between schemas, please continueâ€¦</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">bun <span class="token function">add</span> drizzle-orm <span class="token comment"># Lets us define the schema and gives us types</span>
bun <span class="token function">add</span> -d drizzle-kit <span class="token comment"># Helpful for migrations</span></code></pre></div>
<p>You can then <a href="https://orm.drizzle.team/docs/sql-schema-declaration">create a schema with Drizzle</a>. For this example letâ€™s just create a simple TODO table:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">/// src/app/db/schema.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>
    pgTable<span class="token punctuation">,</span>
    serial<span class="token punctuation">,</span>
    varchar<span class="token punctuation">,</span>
    <span class="token builtin">boolean</span><span class="token punctuation">,</span>
    timestamp<span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"drizzle-orm/pg-core"</span><span class="token punctuation">;</span>
  
  <span class="token keyword">export</span> <span class="token keyword">const</span> todos <span class="token operator">=</span> <span class="token function">pgTable</span><span class="token punctuation">(</span><span class="token string">"todos"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token function">serial</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">primaryKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    content<span class="token operator">:</span> <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> length<span class="token operator">:</span> <span class="token number">255</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    completed<span class="token operator">:</span> <span class="token function">boolean</span><span class="token punctuation">(</span><span class="token string">"completed"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    createdAt<span class="token operator">:</span> <span class="token function">timestamp</span><span class="token punctuation">(</span><span class="token string">"created_at"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">defaultNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Drizzle will provide us with some nice types based on this.</p>
<h2>Gotcha #2 - How do you run migrations in the browser?</h2>
<p>The <a href="https://orm.drizzle.team/docs/get-started/pglite-new">PGlite / Drizzle get started guide</a> is great, but it assumes youâ€™re running PGlite on the server. Thus there are some differences (and unfortunately an undocumented API we need to use..).</p>
<p>Create a Drizzle config file:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> Config <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"drizzle-kit"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  schema<span class="token operator">:</span> <span class="token string">"./src/app/db/schema.ts"</span><span class="token punctuation">,</span>
  out<span class="token operator">:</span> <span class="token string">"./src/app/db/migrations"</span><span class="token punctuation">,</span>
  dialect<span class="token operator">:</span> <span class="token string">"postgresql"</span><span class="token punctuation">,</span>
  driver<span class="token operator">:</span> <span class="token string">"pglite"</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span> satisfies Config<span class="token punctuation">;</span></code></pre></div>
<p>Generate the migration:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">npx drizzle-kit generate <span class="token comment"># generates the SQL files to perform a migration</span></code></pre></div>
<p>Ordinarily you would now run <code class="language-text">npx drizzle-kit migrate</code>, HOWEVER: youâ€™re not on the server, youâ€™re on the client! so this is never going to work. How do you run the migration in the browser?</p>
<h3>Compile offline migrations</h3>
<p>Thankfully I came across a very <a href="https://github.com/drizzle-team/drizzle-orm/discussions/2532">helpful post on GitHub</a> by <a href="https://github.com/daltonkyemiller">@daltonkyemiller</a>. They found an undocumented API that where we can take our generated SQL migration and convert it in to the JSON format required to run it against PGlite.</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// You could execute this standalone script with Bun like so:</span>
<span class="token comment">// drizzle-kit generate &amp;&amp; bun ./src/app/db/compile-migrations.ts</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> readMigrationFiles <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"drizzle-orm/migrator"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">"path"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> migrationsFolder <span class="token operator">=</span> <span class="token string">"./src/app/db/migrations"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> migrations <span class="token operator">=</span> <span class="token function">readMigrationFiles</span><span class="token punctuation">(</span><span class="token punctuation">{</span> migrationsFolder <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">await</span> Bun<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>
  path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>migrationsFolder<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/migrations.json</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>migrations<span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Migrations compiled!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>We now have a <code class="language-text">migrations.json</code> file that can be used in the browser.</p>
<p>ðŸš¨ <em>Unfortunately, as the functions are undocumented, the Drizzle team could break them any point in time. Unfortunately if you want to use Drizzle in the browser then there is no alternative at the time of writing.</em></p>
<h3>Executing the migration</h3>
<p>Setup the migration:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">/// src/app/db/migrate.ts</span>
<span class="token keyword">import</span> <span class="token keyword">type</span> <span class="token punctuation">{</span> MigrationConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"drizzle-orm/migrator"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> db <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./drizzle"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> migrations <span class="token keyword">from</span> <span class="token string">"./migrations/migrations.json"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">migrate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// @ts-ignore</span>
  db<span class="token punctuation">.</span>dialect<span class="token punctuation">.</span><span class="token function">migrate</span><span class="token punctuation">(</span>migrations<span class="token punctuation">,</span> db<span class="token punctuation">.</span>session<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    migrationsTable<span class="token operator">:</span> <span class="token string">"drizzle_migrations"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span> satisfies Omit<span class="token operator">&lt;</span>MigrationConfig<span class="token punctuation">,</span> <span class="token string">"migrationsFolder"</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>and simply execute the exported <code class="language-text">migrate</code> function, e.g.</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token comment">// root.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> migrate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./migrate"</span>

<span class="token function">migrate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>renderApp<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Iâ€™ve provided an example repo at the end of this post showing how I executed the migration wrapped in <a href="https://react.dev/reference/react/Suspense">Suspense</a> so that a placeholder is shown during initialisation.</p>
<h1>Basic CRUD operations</h1>
<p>Itâ€™s just Drizzle all the way forward now, thereâ€™s a bunch of <a href="https://orm.drizzle.team/docs/rqb">documentation</a>, but hereâ€™s some examples sticking with the TODO theme:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">/// src/app/db/actions.ts</span>
<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fetchAllTodos</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> db<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>todos<span class="token punctuation">.</span>createdAt<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">addTodoAction</span><span class="token punctuation">(</span>formData<span class="token operator">:</span> FormData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> todo<span class="token operator">:</span> <span class="token keyword">typeof</span> todos<span class="token punctuation">.</span>$inferInsert <span class="token operator">=</span> <span class="token punctuation">{</span>
    content<span class="token operator">:</span> formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"content"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> inserted <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>todo<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">returning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> inserted<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">deleteTodoAction</span><span class="token punctuation">(</span>formData<span class="token operator">:</span> FormData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>formData<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> deleted <span class="token operator">=</span> <span class="token keyword">await</span> db<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>todos<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token function">eq</span><span class="token punctuation">(</span>todos<span class="token punctuation">.</span>id<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">returning</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> deleted<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h1>Getting data in and out</h1>
<p>Thereâ€™s a number of options depending on what the use-case is, but Iâ€™ll describe an approach I took. If you just want test data, you can use <a href="https://orm.drizzle.team/docs/seed-overview">drizzle-seed</a>.</p>
<h2>CSV Import</h2>
<p>One option to import data is with a CSV. Given itâ€™s running in the browser, you need to be able to obtain the CSV as a blob. This is then mapped to <a href="https://pglite.dev/docs/api#dev-blob">PGliteâ€™s virtual device</a> <code class="language-text">/dev/blob</code>, and then you can just copy the data like you ordinarily would with SQL:</p>
<div class="gatsby-highlight" data-language="typescript"><pre class="language-typescript"><code class="language-typescript"><span class="token comment">// example depicting the copying of citizen data from a CSV in to the citizens table.</span>

<span class="token keyword">const</span> csvResponse <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token string">'/smart_city_citizen_activity.csv'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  COPY citizens(id, age, gender, mode_of_transport)
  FROM '/dev/blob'
  DELIMITER ','
  CSV HEADER;
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  blob<span class="token operator">:</span> <span class="token keyword">await</span> csvResponse<span class="token punctuation">.</span><span class="token function">blob</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div>
<p><em>If youâ€™re storing your data in IndexedDB then youâ€™ll also want to query if the data has already been imported before doing so (to avoid doing so on each load!).</em></p>
<h2>Import/Export alternative with PGlite</h2>
<p>PGlite also supports exporting to a tarball with <a href="https://pglite.dev/docs/api#dumpdatadir">dumpDataDir</a>, and importing with <a href="https://pglite.dev/docs/api#options">loadDataDir</a>. Hereâ€™s an <a href="https://pglite.dev/examples/dump-data-dir">(example of both)</a></p>
<h1>SQL Client</h1>
<p>You might be tempted to reach for your favourite Postgres client (and/or Drizzle Studio). Unfortunately you cannot use it (thereâ€™s no endpoint to connect to!).</p>
<p>One option would be to export and re-import elsewhere to a server Postgres instance.</p>
<p>However, there is a REPL that PGlite provides that letâ€™s you query directly in the browser. Itâ€™s just a <a href="https://pglite.dev/docs/repl">React component (web component also available)</a>:</p>
<div class="gatsby-highlight" data-language="tsx"><pre class="language-tsx"><code class="language-tsx"><span class="token keyword">import</span> <span class="token punctuation">{</span> Repl <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"@electric-sql/pglite-repl"</span><span class="token punctuation">;</span>

<span class="token operator">...</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Repl</span></span> <span class="token attr-name">pg</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>client<span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span></code></pre></div>
<p>Thereâ€™s even a <a href="https://pglite.dev/repl/">live demo of the REPL here</a>.</p>
<h3>Gotcha #3 - Youâ€™re at the mercy of dependencies</h3>
<p>When I was setting up what seemed to be a simple React component for the REPL, I got an error:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">Uncaught Error: No CodeMirror editor found</code></pre></div>
<p>I raised an <a href="https://github.com/electric-sql/pglite/issues/559">issue on GitHub</a> and <a href="https://github.com/ldirer">@ldirer</a> found out itâ€™s related to a change in the CodeMirror dependency itself.</p>
<p>If youâ€™re seeing this issue, the workaround at the time of writing is to override to an older version of React CodeMirror:</p>
<div class="gatsby-highlight" data-language="json"><pre class="language-json"><code class="language-json">  <span class="token property">"overrides"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"@uiw/react-codemirror"</span><span class="token operator">:</span> <span class="token string">"4.23.5"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span></code></pre></div>
<h1>Code &#x26; Demo</h1>
<p>The repo with the <a href="https://github.com/AdrianLThomas/pglite-spa">code can be found here</a>: it shows most things discussed in this post.</p>
<p>You can also see a <a href="http://www.adrian-thomas.com/pglite-spa">live demo of the working code here</a>.</p>
<p>Thanks for reading!</p></section></article></main></div><footer class="layout__Footer-sc-rvd8xs-0 fVXSPP"><span>Â© <!-- -->2025<!-- --> <!-- --><a href="/">adrian-thomas.com</a></span><a href="https://github.com/AdrianLThomas" target="_blank" rel="noreferrer">GitHub</a><a href="https://twitter.com/AdrianLThomas" target="_blank" rel="noreferrer">Twitter</a><a href="https://www.linkedin.com/in/adrianthomas" target="_blank" rel="noreferrer">LinkedIn</a><a href="/blog">Blog</a><a target="_blank" rel="noreferrer" href="/rss.xml">RSS</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-39403JZPVT"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-39403JZPVT', {"send_page_view":false});
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/2025-03-11/running-postgres-in-the-browser/";window.___webpackCompilationHash="730360eb05f7a82349ac";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-55b8df5f151e72b5d2dc.js"],"app":["/app-dad061e5f536956a6be2.js"],"component---src-pages-404-js":["/component---src-pages-404-js-2995d574669c13b134ac.js"],"component---src-pages-blog-js":["/component---src-pages-blog-js-b975a10a9d0c7a31f30b.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-0b182b8b6135f0b205f7.js"]};/*]]>*/</script><script src="/polyfill-55b8df5f151e72b5d2dc.js" nomodule=""></script><script src="/component---src-templates-blog-post-js-0b182b8b6135f0b205f7.js" async=""></script><script src="/commons-1d6544cb43ed1fc99bce.js" async=""></script><script src="/app-dad061e5f536956a6be2.js" async=""></script><script src="/framework-0613c9735af2d6569ef8.js" async=""></script><script src="/webpack-runtime-83d24ad685577667119e.js" async=""></script></body></html>