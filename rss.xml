<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Adrian L Thomas]]></title><description><![CDATA[Pizza, programming and cars - sometimes in that order.]]></description><link>https://www.adrian-thomas.com</link><generator>GatsbyJS</generator><lastBuildDate>Thu, 29 May 2025 10:47:29 GMT</lastBuildDate><item><title><![CDATA[Job hunting as an IC in 2025 - Reflections from a career break]]></title><description><![CDATA[I made the decision earlier in the year to take a career break: It‚Äôs not something I‚Äôve ever done before (I‚Äôve always had another job lined‚Ä¶]]></description><link>https://www.adrian-thomas.com/blog/2025-05-29/finding-an-ic-job-in-2025/</link><guid isPermaLink="false">https://www.adrian-thomas.com/blog/2025-05-29/finding-an-ic-job-in-2025/</guid><pubDate>Thu, 29 May 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I made the decision earlier in the year to take a career break: It‚Äôs not something I‚Äôve ever done before (I‚Äôve always had another job lined up), but knew I wanted some time to spend on myself, some hobbies, and training. Which ultimately meant I‚Äôd need to find a new role eventually.&lt;/p&gt;
&lt;p&gt;Now that I‚Äôm fortunate enough to have secured a new role as part of my career break, I wanted to reflect on my own experience and share it with others, as an IC in 2025. I‚Äôll be talking about applications, interviews, and the evolving role of AI in the process.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This is all based on my own experience &amp;#x26; perceptions, rather than any scientific approach. Also, this post isn‚Äôt about the things I did with my time during the career break: But, I would encourage you to consider a career break yourself! I‚Äôve had a fantastic time.&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;Defining What I Wanted&lt;/h2&gt;
&lt;p&gt;Logically, it makes sense to start with this step. Unfortunately for me, it wasn‚Äôt necessarily clear until I started the process. As part of preparing for upcoming interviews, I looked back at my strengths and achievements that enabled me to really hone in on what inspired me.&lt;/p&gt;
&lt;p&gt;However, I did identify a bunch of areas as part of this preparatory process (that were initially just my gut feeling), thus becoming clearer that I wanted somewhere that:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I was passionate about the product&lt;/li&gt;
&lt;li&gt;I could have ownership&lt;/li&gt;
&lt;li&gt;I could have impact&lt;/li&gt;
&lt;li&gt;Had technical challenges&lt;/li&gt;
&lt;li&gt;Had a strong engineering culture&lt;/li&gt;
&lt;li&gt;Was remote first (with occasional team visits)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I‚Äôd encourage anyone in a similar position to try and define this upfront if you can - I think it would have saved me some time during the application process.&lt;/p&gt;
&lt;h2&gt;Timeline Expectations&lt;/h2&gt;
&lt;p&gt;My initial plan was to take ~2 months out - so my thoughts were if I took a few weeks out without even starting the process: no problem.&lt;/p&gt;
&lt;p&gt;The reality is that it took several weeks from the point of applying (even in the case of referrals) to get to the screening stage; so in retrospect I‚Äôd have definitely started this sooner.&lt;/p&gt;
&lt;p&gt;Once the ball was rolling, expect 4-6 stages with a week in-between. That puts you in the ~2 month range straight away.&lt;/p&gt;
&lt;p&gt;Some organisations I worked with were happy to fast track their process (e.g. bundle interviews to the same day or week) to keep up with other orgs and remain competitive, so it didn‚Äôt seem to be a hard rule either.&lt;/p&gt;
&lt;p&gt;Once the interviews started to come through, it almost immediately turned into a full-time job: from having nothing on, to several at once - all requiring their own preparation!&lt;/p&gt;
&lt;p&gt;In the end, the position I accepted took exactly 2 months from referral to offer - something for future me to remember!&lt;/p&gt;
&lt;h2&gt;Using LinkedIn Effectively To Find A Job&lt;/h2&gt;
&lt;p&gt;I personally heavily relied on LinkedIn: not only for new connections but to keep in touch with old colleagues. When I posted about my &lt;a href=&quot;https://www.linkedin.com/posts/adrianthomas_opentowork-activity-7303071720263831553-DGcZ&quot;&gt;career break&lt;/a&gt; I had a number of folk reach out to me whom I‚Äôd worked with over the years, and also a number who offered to refer me at their companies. If it wasn‚Äôt for the power of LI I‚Äôd have almost certainly missed out on these.&lt;/p&gt;
&lt;p&gt;It also allowed me to reach out to those who I hadn‚Äôt spoken to in some time and gauge whether there were any openings.&lt;/p&gt;
&lt;p&gt;Job alerts on LI were also handy. There was lots of noise, but a number of applications I made and interviewed for were ultimately ones I would have otherwise been unaware of.&lt;/p&gt;
&lt;h3&gt;LI Premium&lt;/h3&gt;
&lt;p&gt;I also gave LI Premium a go (first month was free, then ~¬£30+ after üò±): I personally don‚Äôt think it‚Äôs worth paying for.&lt;/p&gt;
&lt;p&gt;The insights are interesting, particularly to get an understanding how a company is growing and in which areas - but some intentionally paywalled features (like seeing all the people who creeped your profile) I cared less about.&lt;/p&gt;
&lt;p&gt;The AI tools are not that helpful (beyond copying + pasting it straight in to free ChatGPT). Anything that was automatically written came across as AI, and the button to see ‚ÄúAm I suitable for this job?‚Äù was just a bit lazy (it told me I was suitable for things I definitely wasn‚Äôt, and vice versa).&lt;/p&gt;
&lt;h3&gt;InMail / Recruiters&lt;/h3&gt;
&lt;p&gt;I think this is the biggest difference I notice compared to a few years ago. Rather than receiving multiple messages a day - I‚Äôd maybe only be approached once or twice a week. I suspect we‚Äôre still in a bit of a lull due to ZIRP (Zero Interest Rate Policy) &lt;a href=&quot;https://newsletter.pragmaticengineer.com/p/zirp-software-engineers&quot;&gt;(as mentioned by Gergely over a year ago)&lt;/a&gt;, plus perhaps some caution with the AI boom currently ongoing.&lt;/p&gt;
&lt;p&gt;But, there are open jobs out there (startups, scaleups and larger orgs) - just seemingly quieter than it has been in the past.&lt;/p&gt;
&lt;h2&gt;The Application Process&lt;/h2&gt;
&lt;p&gt;Regardless of referral or application, this typically involved submitting an up to date CV. However I did notice that for application forms that had extra fields (e.g. specific questions or asking for a cover letter) that I filled in, I was usually invited to interview rather than a rejection upfront. My assumption is your name lands on a spreadsheet, and if you‚Äôre filling in more columns of that row you‚Äôre more likely to stand out. Or, perhaps this feeds in to some kind of AI matching better?&lt;/p&gt;
&lt;h3&gt;Using AI To Apply&lt;/h3&gt;
&lt;p&gt;This is something I didn‚Äôt do: at least, not in a heavily automated way. Having been using generative AI for a while now - you can usually see immediately when someone has taken something written by AI verbatim. I‚Äôm aware there are tools out there to apply on your behalf, but for such an early and important stage of the process it wasn‚Äôt something I was willing to do.&lt;/p&gt;
&lt;p&gt;However, I‚Äôd be lying if I said I didn‚Äôt use AI either. I did use it to:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Match job specs to the experience on my CV (thus helping me write tailored cover letters or prepare my &lt;a href=&quot;https://jobs.theguardian.com/article/how-to-use-the-star-technique-in-an-interview/&quot;&gt;STAR technique&lt;/a&gt; for interviews)&lt;/li&gt;
&lt;li&gt;Bring structure to my brain dumps&lt;/li&gt;
&lt;li&gt;Generally refine my thoughts and ramblings&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Overall, it helped me be more succinct throughout the preparatory process.&lt;/p&gt;
&lt;h2&gt;Interview Stages&lt;/h2&gt;
&lt;p&gt;The stages were typically: screening, experience deep dive, take home test, test review + improvements discussion, system design and behavioural. Some orgs had fewer stages, but typically encompassed multiple criteria in a single interview. Also some didn‚Äôt have take home tests but opted for instead leet code and/or live pairing.&lt;/p&gt;
&lt;p&gt;This table shows a worst case scenario (with stages and timings):&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Stage&lt;/th&gt;
&lt;th&gt;Typical Duration&lt;/th&gt;
&lt;th&gt;Notes&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Application&lt;/td&gt;
&lt;td&gt;1-3 weeks&lt;/td&gt;
&lt;td&gt;Waiting for responses&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Screening Call&lt;/td&gt;
&lt;td&gt;1 week&lt;/td&gt;
&lt;td&gt;Initial chat with recruiter or manager&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Experience Deep Dive&lt;/td&gt;
&lt;td&gt;1 week&lt;/td&gt;
&lt;td&gt;Technical/role-specific questions&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Take Home Test&lt;/td&gt;
&lt;td&gt;1-2 weeks&lt;/td&gt;
&lt;td&gt;Sometimes replaced by leet code / pair programming&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Test Review&lt;/td&gt;
&lt;td&gt;1 week&lt;/td&gt;
&lt;td&gt;Discuss solution &amp;#x26; improvements&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;System Design&lt;/td&gt;
&lt;td&gt;1 week&lt;/td&gt;
&lt;td&gt;High-level technical interview&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Behavioural&lt;/td&gt;
&lt;td&gt;1 week&lt;/td&gt;
&lt;td&gt;Culture fit, values, teamwork&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Offer&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;Use of AI&lt;/h3&gt;
&lt;p&gt;Again I‚Äôll mostly be talking about my own usage. The only thing I noticed from the hiring side was that an AI notetaker was commonly in the same calls too.&lt;/p&gt;
&lt;p&gt;The expectations on usage varied quite a bit depending on the company‚Ä¶&lt;/p&gt;
&lt;h4&gt;Timeboxed Take Home Test&lt;/h4&gt;
&lt;p&gt;I observed 3 scenarios that companies said:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;You cannot use AI - just stick to the timebox&lt;/li&gt;
&lt;li&gt;You can use AI, but you will be asked about the code written&lt;/li&gt;
&lt;li&gt;No mention of AI at all&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Scenario 1 is just what my experience was before the rise of AI. The solution you submit may not be perfect for a given timebox, but you‚Äôre given an opportunity to discuss those tradeoffs &amp;#x26; shortcomings.&lt;/p&gt;
&lt;p&gt;I think Scenario 2 is just the reality of people using AI today in their work: you‚Äôve got to understand and justify what you‚Äôre producing for it to be sustainable.&lt;/p&gt;
&lt;p&gt;Scenario 3 obviously requires follow up clarification, otherwise there will be an assumption on either side about its use.&lt;/p&gt;
&lt;h4&gt;Pairing / LeetCode&lt;/h4&gt;
&lt;p&gt;For me personally, this was the worst stage. Many of the companies pre-empt this by asking you to treat your interviewers as colleagues, and to rely on them as you would in reality.&lt;/p&gt;
&lt;p&gt;Despite my years of experience, I feel flustered, rushed and panicked. I was never good at Drama in school, so pretending it was anything other than an interview didn‚Äôt work for me. These are people you‚Äôve not met before, and are supposed to feel comfortable with for that 30-60 minute window - I‚Äôm not even sure how to overcome this beyond practicing more interviews!&lt;/p&gt;
&lt;p&gt;I did find the problems themselves weren‚Äôt too ridiculous (e.g. I didn‚Äôt get asked to implement some obscure algorithm). It was usually a problem I needed to read, understand and then introduce a change to (whilst collaborating with those on the call).&lt;/p&gt;
&lt;p&gt;I feel like having some quiet time to read / reflect on the problem before starting the exercise would have made a significant improvement to the process (e.g. the interviewers drop off the call for the first 10 minutes, or send out the material 15 minutes before the call). That way, I have a mental model of the problem and can collaborate much better with the interviewers.&lt;/p&gt;
&lt;h2&gt;Final Thoughts&lt;/h2&gt;
&lt;p&gt;Overall it has been a very interesting process, and one I‚Äôve not had before. I‚Äôm super grateful to all the friends and colleagues I‚Äôve had the pleasure of working with over the years. Now it‚Äôs time for me to enjoy some more time off before a new exciting role at the end of June!&lt;/p&gt;
&lt;p&gt;I hope you enjoyed this post. There‚Äôs a bunch of things I didn‚Äôt talk about too, like:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;How I organised myself and prepared for each interview&lt;/li&gt;
&lt;li&gt;How I made notes on each company and stage&lt;/li&gt;
&lt;li&gt;Specifics around each stage&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So feel free to let me know any thoughts or questions! You can find the &lt;a href=&quot;https://www.linkedin.com/posts/adrianthomas_job-hunting-as-an-ic-in-2025-reflections-activity-7333805176954249217-1SzV&quot;&gt;LinkedIn post here&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Reading my water meter in Home Assistant]]></title><description><![CDATA[Water bills in the UK are going up, again, and I thought it would be nice to keep a closer eye on the household usage by integrating the‚Ä¶]]></description><link>https://www.adrian-thomas.com/blog/2025-03-17/reading-my-water-meter-in-home-assistant/</link><guid isPermaLink="false">https://www.adrian-thomas.com/blog/2025-03-17/reading-my-water-meter-in-home-assistant/</guid><pubDate>Mon, 17 Mar 2025 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Water bills in the UK &lt;a href=&quot;https://www.bbc.co.uk/news/articles/c5yd9qzx79go&quot;&gt;are going up, again&lt;/a&gt;, and I thought it would be nice to keep a closer eye on the household usage by integrating the water meter in to &lt;a href=&quot;https://www.home-assistant.io/&quot;&gt;Home Assistant&lt;/a&gt;.&lt;/p&gt;
&lt;h1&gt;What I wanted to do&lt;/h1&gt;
&lt;p&gt;I wanted the water meter readings in Home Assistant so perhaps I could set up alerts and generally try to reduce how much water was being used (and identify when/where it gets used the most).&lt;/p&gt;
&lt;h2&gt;Setting up HA (Home Assistant)&lt;/h2&gt;
&lt;p&gt;I already had Home Assistant set up, but it‚Äôs simple enough to get started if you‚Äôre already self hosting things &lt;a href=&quot;https://www.home-assistant.io/installation/linux#docker-compose&quot;&gt;with Docker&lt;/a&gt; (e.g. homelab, raspberry pi or an off the shelf device). There‚Äôs quite a &lt;a href=&quot;https://www.home-assistant.io/installation/&quot;&gt;few options available&lt;/a&gt;.&lt;/p&gt;
&lt;h1&gt;The Solution&lt;/h1&gt;
&lt;p&gt;The solution for you could well differ from mine, there‚Äôs a ton of &lt;a href=&quot;https://www.home-assistant.io/docs/energy/water/&quot;&gt;options documented to read your water meter&lt;/a&gt;, but in my case I had an Irton EverBlu Cyble water meter, that as far as I know is fairly common in the UK. So the first step would be identify what you have so that you can work out how to read it.&lt;/p&gt;
&lt;p&gt;I came &lt;a href=&quot;https://community.home-assistant.io/t/reading-itron-everblu-cyble-rf-enhanced-water-meter-with-esp32-esp8266-and-433mhz-cc1101-home-assistant-mqtt-autodiscovery/833180&quot;&gt;across this post on the HA forum&lt;/a&gt; describing a solution for reading my meter using a 433MHz transceiver (the same way the water company reads the meter from the van outside your house).&lt;/p&gt;
&lt;p&gt;I already had some spare ESP8266‚Äôs around, so just needed a CC1101 transceiver which only cost a few quid off Amazon.&lt;/p&gt;
&lt;h2&gt;ESP.. what?&lt;/h2&gt;
&lt;p&gt;The ESP8266 is a very cheap microcontroller (as in only a few pounds), with built in WiFi.&lt;/p&gt;
&lt;p&gt;They‚Äôre not very powerful (80-160MHz), but for most IoT projects they don‚Äôt need to be. If you‚Äôve ever used an Arduino or used the SPI pins on a Raspberry Pi, you‚Äôll feel right at home.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a092bc88a280b8738e2218978499186f/29114/esp8266.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADW0lEQVQ4yz2Q209bBRzHz5/gw14EyyCbAV3GaJBqAkMYrFwsaxGMEViwGZBNszkyZdwGzGDHZUCht9PL6WnP6Tmnpz29UDpn9MEXfTM++KBPmphooib+DR/Tmuzh8/r5fn4/oXRapVx5RqF4SuXsOdUvv6FaKeLf3eDe3Ts8Wl+lVK5QrX5FqVR5gWWVyOUL5HIFdCOHppsoqoZQLJ9RLFcolirkrDLhk32+NnwYcR/ffVshdLjJ/NyHmPkCZ9XnWIVSfTxvFcmaecycha6baFoWRdEQCrW14ilWscz6xjrX+rrZ2fiYP377kX//+pm/f/8BUz1h7tYMiqrWpbWymlA3zLo0oxmoqk4qpSLkCmXMXKEu9e3u4nINc8PZxecrC/zz50/8+sv3PFpawD3ah+ddN4FQkNOzZ3WRZpgY2RxqxkBRdWS5JrTK6KZFNl9E0U0Gr1/D6RxkqK+T+ZseerodnDv3ElNT7+HxjDEw2M/e/l797zWRqhmkVZ2krCIlFQTTKqFla2s5pFSGqekZmpubGBoeoqfrCh8Md+KdHsduv4Lb7cI19g5djjdYXVutV9bKaiSTCpKkIGimhaJlSak68WSapeU1HI43sTXZGHEOMDNi5/3xUSYmJ7Hb27n46gVGRod5u7eb5YefoWomcipDPJEiGpMR9KyFkjFIZ/S6NBAMc++TRTo7O2loeJmevgFcbjcTE+N0dLTj9c6QSARxjTpZXVt7cW48niIWSyFkjDzJlEo683+lGJN4enDEnY/ucvlyO83nbfT39+FyuVj69D6+7XW2NpfxeNzsH/gJiwliiTSimCQiSggZzSQpK6hatk5CkgmFRPb2D5ibv01raystLU10Obro6+3m0mut2Gw2eq9eZWVlDf9xqH5qJCIRDMUQkmmdaFxGVgxkRScWlwlHYpwEImx/scP0zCxtbW2cb2rAZmvklcZGLl5o4cbYGJtb2xwcBgiFE3UCgSiCouhIUopMJouqGiSlNIm4TCwqEQxE8G3v4J29xVsOB+2XXsfe0c6w8zqL9xd5un/MyXGEYDCGGJEIBEQEUUwQCIrIaYOknCEciRMMioSCUfxHQXaf7LGxvsXC/G0mJybwznp58OAhjx/7ODwK4T8WOT6JEggleLLr5z9HrZVt5gvYhgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;a picture of an ESP8266&quot;
        title=&quot;ESP8266&quot;
        src=&quot;/static/a092bc88a280b8738e2218978499186f/f058b/esp8266.png&quot;
        srcset=&quot;/static/a092bc88a280b8738e2218978499186f/c26ae/esp8266.png 158w,
/static/a092bc88a280b8738e2218978499186f/6bdcf/esp8266.png 315w,
/static/a092bc88a280b8738e2218978499186f/f058b/esp8266.png 630w,
/static/a092bc88a280b8738e2218978499186f/40601/esp8266.png 945w,
/static/a092bc88a280b8738e2218978499186f/78612/esp8266.png 1260w,
/static/a092bc88a280b8738e2218978499186f/29114/esp8266.png 1920w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;CC1.. what?&lt;/h2&gt;
&lt;p&gt;I didn‚Äôt know much about the CC1101 until recently either. It‚Äôs described as a low-cost sub-1 GHz transceiver designed for very low-power wireless applications.&lt;/p&gt;
&lt;p&gt;Basically, you can use it to wirelessly read data from your meter.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/7fb6c970300cc3c1966716930447de4c/73caa/cc1101.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.62025316455697%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAADQElEQVQ4y2WT70+TVxiG+we4Dzg1EraoiWFxmTJISBY+EGEd26omUzM1mcFlZFMww8GCdAWsVAGVKBARtBOwP3Q6ZlwLImDmJiDSlrlhZ0SdKGIpRNE6aIvt+76Xabu3dNmdnJwP55wr93nu51EQkiQhSVJ0Dy1RDC0xdEisZgV4PDVDm/0ehy0Ovqi10nbNGT4TRBFFhPfvI0mGzEmQ4NmMH+cDN90DTnr6rlFrtLK29DSZ+UdR5VbxdVUzT15Mh+8rpBhXMng2EOSv0Sn+Hhnhcr+N5gsWNuua+eZAC0fq9OzU1vOl7ns+KqwnY2sRWV9VYmi/KgNjHUl0226wTd+Pau9P9NiuM+sZ41OdkcTtenT1Z/hwx0HeTl1N2ntprMrWkZ5XzbrcCr6tNuF+8jzy5WAgwEu/F6/Hxd3Bc+yvOcKOksOs1Rg4cNJKltrM+vIzaGuaUVcbUH68gfRMFamf7SGnwsSaghrSik+Re7wdxdOxQabuW3jx0Mo/7gEmhy9iOFZOwXc6ciubUBUbyK82U1hzHmWxkQ3l59i2t4WcfS0k5ul5X9PClkOn0ZraaR/4A8Wjvipu/VpL/4+76TQU0tpQwM+nSjAfLafs0DHWl55gfOwOvXYHb23X80ZOI2vKjFSYO7D0OLg16gIpGIovUsP7vY30ni3E0VbGI+d5ZsYHsF85ySeaBt7deZxMjZnfbHau223UtXbROzTMtM8brbpvehq743f2Vx7EYr2I4qX3OYLPDdJspE0EETHgpe6Sg1LTZVqv3sA58pigIIcnMnz7DmbzD+TnF6BSrWPlyiQWL45nxYp3IqFEMxbFaOuIwlz6k+5xurq62aPVsXHjJlJSUlm6dBkLFiwiLm4+8fEJJCensLtILffhHCikgH8KRBdGQxObNm8lPT2D5csTSUh4k7i418OgJUuWoVRmoVZr6OzsZGJiIlLD2EkRhSBPH/bhGb2A524ju3I+YN5r81m4cFHYRVJSMtnZn9PQ0MjQ0E38fv9/pkqMHT0ZOnHTzC9ni2jSKtHmrSYjM4uSklI6Oi5FXcQqGAwiCEIYFmJEayhPjMf1J/dsJm4PdjDpGsHn+7+LEEQGyEbk/RVlVHdokwvwbAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;a picture of the CC1101 transceiver that operates at 433MHz&quot;
        title=&quot;CC1101 transceiver - 433MHz&quot;
        src=&quot;/static/7fb6c970300cc3c1966716930447de4c/f058b/cc1101.png&quot;
        srcset=&quot;/static/7fb6c970300cc3c1966716930447de4c/c26ae/cc1101.png 158w,
/static/7fb6c970300cc3c1966716930447de4c/6bdcf/cc1101.png 315w,
/static/7fb6c970300cc3c1966716930447de4c/f058b/cc1101.png 630w,
/static/7fb6c970300cc3c1966716930447de4c/40601/cc1101.png 945w,
/static/7fb6c970300cc3c1966716930447de4c/73caa/cc1101.png 1110w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;MQTT&lt;/h2&gt;
&lt;p&gt;We‚Äôll be using &lt;a href=&quot;https://mqtt.org/&quot;&gt;MQTT&lt;/a&gt; for this. It is a lightweight message queue, commonly used for IoT. We can publish the state of the water meter to it, and Home Assistant will subscribe to these updates accordingly.&lt;/p&gt;
&lt;h1&gt;Getting started&lt;/h1&gt;
&lt;p&gt;So if you want to follow along, I‚Äôm making the following assumptions:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;You have the same water meter as me&lt;/li&gt;
&lt;li&gt;You have Home Assistant set up and running&lt;/li&gt;
&lt;li&gt;You have an ESP8266&lt;/li&gt;
&lt;li&gt;You have a CC1101&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;Wiring up the CC1101 to the ESP8266&lt;/h1&gt;
&lt;p&gt;When you buy a component like the CC1101 you normally get a pin out diagram, either from the manufacturer or you can find one online, that looks something like this:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f9ad159960a5ce7135e74808de42eeec/d7542/cc1101-pinout.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 94.9367088607595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAADeklEQVQ4y42S229UVRSH5z8x0UexfeBRookomhiBhsIDiZo0Jj7oixHx3fgiGmLBXuiF0kZaK1q1NcSodNoZKYkQIBa0l6mZmTM9cylzbjNz7mc+s850aqFqXMnK3vuc3/r2b+29E91HnuTrry6wdP0HUotzpFJzLCzMMn9thuT8N6QWZ0ktfsfiwrck52dIp2b5JT1HOj0X60W7uDBLOvU9lz/vJ3G8qwNFyfBolCsm5bKJ57fWfgCa7vFfoWkGie6uTjKZ5fiD5zlUq1XKJZWt/MdUlVNUldNoyrtohVPom6epKu+hKW9TUT7DdSPCwMN1HBzbjhkxcGPj3vYeTR48qJLLrlNXX8MtvYxffgb0faB3grUPrE7QH6deehMnalVFUROtWsVzPQE+RSZzj2YTTEPH83x0vYKh9GAXD+MUD1HP7qe0eoA/bj/P73deQl15muXkUTLXh7g6+QGVYg7bdmKnieMC3HZomYaYxHNq6EoPjeJhbPVFln49wvTVV5meOcGPPx9j9e5z3PzyAMtDPUy8/wrF7Cq27baA3V0dOy2HQUAzbOI0DMzCSdziC6ysHWVl7SDJW93cufssxVwHbD1B8c/XqbvSLgR+gK5p+J5P4sSx/eTya60TjJqxwyDwqZUvoFXOoKq9lIofklwe5Pb9d1hZf4tN5Q20rfGHbjgMWgeaOHTwMW7c+ImtrRKqmqdYVCgU8mRzKtl8iY18mSs3C0wnl5hLX+HarRnur/9GLqeyWcjGNepmnlKpQLlUIDEy/BFTk/1MTQ4wPHKW0YvnGB7tZWS0l4tj5xgcOkv/8Kf0DZxhYOgTxsbOMzE+yKVLfYyP9zExfp7JywN8MTUYZ2K3bcuq0Wg41OsN6rUGQRBiGCa+62HoJrpuEvhh/BJ8P8D3Q1zXf6j1RBgGRFGIjE15O4Dj2IRhuLOW//Lga7Ua9bpkHcsysSwL0zTxPI8oimJd4u+iaAfiOE7sTtZBEBCFYQyTYkmr1oKKrtFoxLr4UpvNvUAJEQlIdpa5aNrA2rYr3/dj/e5O/hXoum68FqBkGyhtijPbtuNRUjYU7V7g9m4SUvAoUM7LMIwY3Aa04x8dhruAtV1nJHDRSJu6rqNpWuyq3ZXk/wIKSIAyF424E5ikzNtn1849QBnFlTiRgvaTaM/FnaRhiEu9dduWFV/ebuBfy1Je2bLknisAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;a diagram of the CC1101 pinout&quot;
        title=&quot;CC1101 pin out&quot;
        src=&quot;/static/f9ad159960a5ce7135e74808de42eeec/f058b/cc1101-pinout.png&quot;
        srcset=&quot;/static/f9ad159960a5ce7135e74808de42eeec/c26ae/cc1101-pinout.png 158w,
/static/f9ad159960a5ce7135e74808de42eeec/6bdcf/cc1101-pinout.png 315w,
/static/f9ad159960a5ce7135e74808de42eeec/f058b/cc1101-pinout.png 630w,
/static/f9ad159960a5ce7135e74808de42eeec/d7542/cc1101-pinout.png 810w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The code we‚Äôre going to use provided this mapping table; so attach the CC1101 accordingly:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;strong&gt;CC1101&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;ESP8266&lt;/strong&gt;&lt;/th&gt;
&lt;th&gt;&lt;strong&gt;Notes&lt;/strong&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;VCC&lt;/td&gt;
&lt;td&gt;3V3&lt;/td&gt;
&lt;td&gt;Connect to the 3.3V power pin.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GDO0&lt;/td&gt;
&lt;td&gt;D1&lt;/td&gt;
&lt;td&gt;General-purpose digital output.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CSN&lt;/td&gt;
&lt;td&gt;D8&lt;/td&gt;
&lt;td&gt;SPI chip select; Feather has GPIO15 as CS.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SCK&lt;/td&gt;
&lt;td&gt;D5&lt;/td&gt;
&lt;td&gt;SPI clock pin; SPI SCK maps to GPIO14.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MOSI&lt;/td&gt;
&lt;td&gt;D7&lt;/td&gt;
&lt;td&gt;SPI MOSI pin; maps to GPIO13 on the Feather.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GDO1 (MISO)&lt;/td&gt;
&lt;td&gt;D6&lt;/td&gt;
&lt;td&gt;SPI MISO pin; maps to GPIO12 on the Feather.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GDO2&lt;/td&gt;
&lt;td&gt;D2&lt;/td&gt;
&lt;td&gt;Another general-purpose digital output.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GND&lt;/td&gt;
&lt;td&gt;G&lt;/td&gt;
&lt;td&gt;Connect to ground.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;em&gt;The original table can be found in the source repository &lt;code class=&quot;language-text&quot;&gt;README.md&lt;/code&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;You should then end up with something like this:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/641670381f7044dc246af484b1b3d2e8/2c3a2/esp8266-wired-up.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 104.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAVABQDASIAAhEBAxEB/8QAGQABAAIDAAAAAAAAAAAAAAAAAAEDBAUG/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAcFdA1IJ0FYVrBUf/8QAHhAAAQMEAwAAAAAAAAAAAAAAAQACAwQQERMSIjH/2gAIAQEAAQUCXltEi0uCd1OEYQ41LeEn/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPwEf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPwEf/8QAGxAAAgIDAQAAAAAAAAAAAAAAABEBEAIxYZH/2gAIAQEABj8CvRM5L22xcP/EABoQAQADAQEBAAAAAAAAAAAAAAEAETEhQRD/2gAIAQEAAT8huPVO/B7oWZ2Yw9YwPpcKxAl3yARp1k//2gAMAwEAAgADAAAAECjvgv/EABgRAAMBAQAAAAAAAAAAAAAAAAABMRAR/9oACAEDAQE/EHc4h0//xAAXEQADAQAAAAAAAAAAAAAAAAAAARAR/9oACAECAQE/EEZEf//EABsQAQADAAMBAAAAAAAAAAAAAAEAESExQVFh/9oACAEBAAE/EC2GvUb0XE+wWtYK0cQNX9YowRrqXLxFeQbg55DoynDCpSKJsntZ/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;esp8266 wired up to a cc1101&quot;
        title=&quot;esp8266 wired up to a cc1101&quot;
        src=&quot;/static/641670381f7044dc246af484b1b3d2e8/828fb/esp8266-wired-up.jpg&quot;
        srcset=&quot;/static/641670381f7044dc246af484b1b3d2e8/ff44c/esp8266-wired-up.jpg 158w,
/static/641670381f7044dc246af484b1b3d2e8/a6688/esp8266-wired-up.jpg 315w,
/static/641670381f7044dc246af484b1b3d2e8/828fb/esp8266-wired-up.jpg 630w,
/static/641670381f7044dc246af484b1b3d2e8/0ede0/esp8266-wired-up.jpg 945w,
/static/641670381f7044dc246af484b1b3d2e8/3ac88/esp8266-wired-up.jpg 1260w,
/static/641670381f7044dc246af484b1b3d2e8/2c3a2/esp8266-wired-up.jpg 1402w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h1&gt;Problem 1: How do we compile this thing?&lt;/h1&gt;
&lt;p&gt;OK so going back to the original forum post, the code takes us to &lt;a href=&quot;https://github.com/genestealer/everblu-meters-esp8266-improved&quot;&gt;this repository&lt;/a&gt; that is a fork of some older code. I had some issues (documentation and code changes), so of course I forked the fork, and you can &lt;a href=&quot;https://github.com/AdrianLThomas/everblu-meters-esp8266-improved&quot;&gt;find it here&lt;/a&gt;. This fork will remain the basis of what I refer to for the rest of the blog post.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;I raised a PR for the original maintainer, but at the time of writing it hasn‚Äôt yet been merged.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Previously when tinkering with the ESP8266 I just used the Arduino IDE - it‚Äôs fairly straightforward to get up and running. You write some C, compile, upload, and away you go. I‚Äôd also used &lt;a href=&quot;https://esphome.io/&quot;&gt;ESPHome&lt;/a&gt; which is a really nice declarative way to wire up components just using YAML.&lt;/p&gt;
&lt;p&gt;However this project wasn‚Äôt using either, but I did spot there was a &lt;code class=&quot;language-text&quot;&gt;platformio.ini&lt;/code&gt; file. That means this repo is a &lt;a href=&quot;https://platformio.org/&quot;&gt;PlatformIO&lt;/a&gt; project: effectively a VS Code extension to compile, debug, test and upload code to various IoT devices. It‚Äôs new to me but looks pretty nice, and I look forward to trying it out more in the future.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Setting up VSCode and PlatformIO are straightforward so I‚Äôll leave Google to handle that for you.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Finally, you need to configure some private variables as part of the build:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/// Private.h&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;secret_wifi_ssid&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;your wifi ssid&quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;secret_wifi_password&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;your wifi password&quot;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;secret_mqtt_server&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ip of your mqtt server&quot;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;secret_clientName&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;whatever unique client name you want to use&quot;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;secret_mqtt_username&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;your mqtt user&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// or leave blank if not using&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;secret_mqtt_password&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;your mqtt pass&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// or leave blank if not using&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;secret_local_timeclock_server&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;pool.ntp.org&quot;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Change these define according to your hardware&lt;/span&gt;

&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;METER_YEAR&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;// last two digits (e.g. 2019 is 19)&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;METER_SERIAL&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token number&quot;&gt;123456&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;// your 6 digit serial&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;FREQUENCY&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token number&quot;&gt;433.700007&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;// you can test for this using the test code in everblu-meters-esp8266.cpp&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;&lt;span class=&quot;token directive-hash&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; &lt;span class=&quot;token macro-name&quot;&gt;GDO0&lt;/span&gt; &lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;//header 11 &lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We‚Äôve not set up MQTT yet. More on this below - just come back to this config file once you‚Äôre ready.&lt;/p&gt;
&lt;h1&gt;Problem 2: Finding the right frequency&lt;/h1&gt;
&lt;p&gt;OK so now we can compile the code, we need to find the correct frequency. I mentioned before the transceiver works on 433MHz, but you need to calibrate it to work on the EXACT frequency to be a little lower/higher against your meter.&lt;/p&gt;
&lt;p&gt;I‚Äôll defer this step back to the &lt;a href=&quot;https://github.com/AdrianLThomas/everblu-meters-esp8266-improved?tab=readme-ov-file#frequency-adjustment&quot;&gt;repo instructions&lt;/a&gt;, but effectively there are some debug statements that you can uncomment that will write out to the serial monitor. Once you‚Äôve found the correct one you can update your configuration accordingly (as per the snippet in the previous section).&lt;/p&gt;
&lt;h1&gt;Problem 3: Setting up MQTT&lt;/h1&gt;
&lt;p&gt;I‚Äôll also gloss over this step too, but for me this was just a simple case of adding another container to my Docker Compose setup. I used &lt;a href=&quot;https://hub.docker.com/_/eclipse-mosquitto&quot;&gt;Eclipse Mosquitto&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;mosquitto&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; eclipse&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;mosquitto&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;latest
    &lt;span class=&quot;token key atrule&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; mosquitto
    &lt;span class=&quot;token key atrule&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; unless&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;stopped
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1883:1883&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; /your&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;path/mosquitto/config&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/mosquitto/config
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; /your&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;path/mosquitto/data&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/mosquitto/data
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; /your&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;path/mosquitto/log&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;/mosquitto/log&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;Problem 4: Device not being auto discovered in HA&lt;/h1&gt;
&lt;p&gt;The final issue I ran into was that the device was not being detected by HA.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;When connecting to the serial monitor, the device was connecting to the meter OK and outputting the data&lt;/li&gt;
&lt;li&gt;I could see that the ESP8266 had an IP address, so it must be connecting to the wifi fine&lt;/li&gt;
&lt;li&gt;Viewing the Mosquitto container logs showed that messages were being received as expected from the esp8266&lt;/li&gt;
&lt;li&gt;Manually subscribing to all topics (&lt;code class=&quot;language-text&quot;&gt;#&lt;/code&gt;) in HA showed that messages were being received correctly&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;..yet no device appeared in HA&lt;/p&gt;
&lt;p&gt;I enabled ‚Äòdebug logging‚Äô for MQTT in HA:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cbe0410e4869f1e4c6e99309f0770fad/2e237/debugging-mqtt-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.65822784810127%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABnklEQVQ4y5WSS27bQBBEeQKJkij+PzPDn4ciaQqUV4K9yym09iInMBwdvuJqmAISJJC9KDSHzX5TNUNHaY1hGDCOI06nEzprkSQJlFJgb55PKMtS3mVZhjRNpf5L7DkcOhwOaNsWTV3DGCPDURSJCI7jGH4QIAgC+L6P/X4vlfI8D7vdTp7Zdwjo+wGlMQjD8AZbr9ei1Wol1XVdEQHsL4AlDWe32y0cbQysteKClikObDabP0QYnXiBh9cfr3j/+Y63X2+4Xq+4XC6Skps5VVVhGEYUeS67LUAC/gbSATcezYj5ccY8zzifz3JMdCmRtTY4Tkc5+MXl/4CsRVHA1CVsZ9F1nawZl3fAeacolNjVWt8FUvyuqmo5pjzPb7fLZ4IdNsdhlBf3IlOMxmPq+/6WinM3IBcL6B6QVSsloKZpBLzM0bkAl5u9C/yE8gKaphWHj9Mka7rkBpz7MnDzGdlohYe6gW1bUcrIUYT2u0A63Lku5rrGk7V4nibRy3TEVJboswz6u5G3vJQwhI5jGCpJUKUpVBSh8H2EHz/2b7yxW2xM49E6AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;enabling debug logging for mqtt&quot;
        title=&quot;enabling debug logging for mqtt&quot;
        src=&quot;/static/cbe0410e4869f1e4c6e99309f0770fad/f058b/debugging-mqtt-1.png&quot;
        srcset=&quot;/static/cbe0410e4869f1e4c6e99309f0770fad/c26ae/debugging-mqtt-1.png 158w,
/static/cbe0410e4869f1e4c6e99309f0770fad/6bdcf/debugging-mqtt-1.png 315w,
/static/cbe0410e4869f1e4c6e99309f0770fad/f058b/debugging-mqtt-1.png 630w,
/static/cbe0410e4869f1e4c6e99309f0770fad/2e237/debugging-mqtt-1.png 790w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;and looked at the &lt;em&gt;system&lt;/em&gt; logs.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;üí° Tip: this is NOT the activity logbook, but the logs under Settings &gt; System &gt; Logs&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;I could then see what the error was:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Logger: homeassistant.components.mqtt.entity
Source: components/mqtt/entity.py:155
integration: MQTT (documentation, issues)
First occurred: 02:11:02 (19 occurrences)
Last logged: 10:38:09

    Error &apos;extra keys not allowed @ data[&apos;device&apos;][&apos;support_url&apos;]&apos; when processing MQTT discovery message topic: &apos;homeassistant/sensor/water_meter_wifi_bssid/config&apos;, message: &apos;{&apos;unique_id&apos;: &apos;water_meter_wifi_bssid&apos;, &apos;object_id&apos;: &apos;water_meter_wifi_bssid&apos;, &apos;icon&apos;: &apos;mdi:access-point-network&apos;, &apos;qos&apos;: &apos;0&apos;, &apos;state_topic&apos;: &apos;everblu/cyble/bssid&apos;, &apos;force_update&apos;: &apos;true&apos;, &apos;entity_category&apos;: &apos;diagnostic&apos;, &apos;device&apos;: {&apos;identifiers&apos;: [&apos;14071984&apos;], &apos;model&apos;: &apos;Itron EverBlu Cyble Enhanced Water Meter ESP8266/ESP32&apos;, &apos;manufacturer&apos;: &apos;Psykokwak [Forked by Genestealer]&apos;, &apos;support_url&apos;: &apos;https://github.com/genestealer/everblu-meters-esp8266-improved&apos;, &apos;suggested_area&apos;: &apos;Home&apos;, &apos;name&apos;: &apos;Water Meter&apos;}, &apos;name&apos;: &apos;WiFi BSSID&apos;}&apos;
    Error &apos;expected SensorDeviceClass or one of &apos;date&apos;, &apos;enum&apos;, &apos;timestamp&apos;, &apos;apparent_power&apos;, &apos;aqi&apos;, &apos;area&apos;, &apos;atmospheric_pressure&apos;, &apos;battery&apos;, &apos;blood_glucose_concentration&apos;, &apos;carbon_monoxide&apos;, &apos;carbon_dioxide&apos;, &apos;conductivity&apos;, &apos;current&apos;, &apos;data_rate&apos;, &apos;data_size&apos;, &apos;distance&apos;, &apos;duration&apos;, &apos;energy&apos;, &apos;energy_distance&apos;, &apos;energy_storage&apos;, &apos;frequency&apos;, &apos;gas&apos;, &apos;humidity&apos;, &apos;illuminance&apos;, &apos;irradiance&apos;, &apos;moisture&apos;, &apos;monetary&apos;, &apos;nitrogen_dioxide&apos;, &apos;nitrogen_monoxide&apos;, &apos;nitrous_oxide&apos;, &apos;ozone&apos;, &apos;ph&apos;, &apos;pm1&apos;, &apos;pm10&apos;, &apos;pm25&apos;, &apos;power_factor&apos;, &apos;power&apos;, &apos;precipitation&apos;, &apos;precipitation_intensity&apos;, &apos;pressure&apos;, &apos;reactive_power&apos;, &apos;signal_strength&apos;, &apos;sound_pressure&apos;, &apos;speed&apos;, &apos;sulphur_dioxide&apos;, &apos;temperature&apos;, &apos;volatile_organic_compounds&apos;, &apos;volatile_organic_compounds_parts&apos;, &apos;voltage&apos;, &apos;volume&apos;, &apos;volume_storage&apos;, &apos;volume_flow_rate&apos;, &apos;water&apos;, &apos;weight&apos;, &apos;wind_direction&apos;, &apos;wind_speed&apos; for dictionary value @ data[&apos;device_class&apos;]&apos; when processing MQTT discovery message topic: &apos;homeassistant/sensor/water_meter_wifi_status/config&apos;, message: &apos;{&apos;unique_id&apos;: &apos;water_meter_wifi_status&apos;, &apos;object_id&apos;: &apos;water_meter_wifi_status&apos;, &apos;device_class&apos;: &apos;connectivity&apos;, &apos;qos&apos;: &apos;0&apos;, &apos;state_topic&apos;: &apos;everblu/cyble/status&apos;, &apos;force_update&apos;: &apos;true&apos;, &apos;entity_category&apos;: &apos;diagnostic&apos;, &apos;device&apos;: {&apos;identifiers&apos;: [&apos;14071984&apos;], &apos;model&apos;: &apos;Itron EverBlu Cyble Enhanced Water Meter ESP8266/ESP32&apos;, &apos;manufacturer&apos;: &apos;Psykokwak [Forked by Genestealer]&apos;, &apos;support_url&apos;: &apos;https://github.com/genestealer/everblu-meters-esp8266-improved&apos;, &apos;suggested_area&apos;: &apos;Home&apos;, &apos;name&apos;: &apos;Water Meter&apos;}, &apos;name&apos;: &apos;WiFi Status&apos;}&apos;
    Error &apos;extra keys not allowed @ data[&apos;device&apos;][&apos;support_url&apos;]&apos; when processing MQTT discovery message topic: &apos;homeassistant/sensor/water_meter_uptime/config&apos;, message: &apos;{&apos;unique_id&apos;: &apos;water_meter_uptime&apos;, &apos;object_id&apos;: &apos;water_meter_uptime&apos;, &apos;device_class&apos;: &apos;timestamp&apos;, &apos;qos&apos;: &apos;0&apos;, &apos;state_topic&apos;: &apos;everblu/cyble/uptime&apos;, &apos;force_update&apos;: &apos;true&apos;, &apos;entity_category&apos;: &apos;diagnostic&apos;, &apos;device&apos;: {&apos;identifiers&apos;: [&apos;14071984&apos;], &apos;model&apos;: &apos;Itron EverBlu Cyble Enhanced Water Meter ESP8266/ESP32&apos;, &apos;manufacturer&apos;: &apos;Psykokwak [Forked by Genestealer]&apos;, &apos;support_url&apos;: &apos;https://github.com/genestealer/everblu-meters-esp8266-improved&apos;, &apos;suggested_area&apos;: &apos;Home&apos;, &apos;name&apos;: &apos;Water Meter&apos;}, &apos;name&apos;: &apos;Device Uptime&apos;}&apos;
    Error &apos;extra keys not allowed @ data[&apos;device&apos;][&apos;support_url&apos;]&apos; when processing MQTT discovery message topic: &apos;homeassistant/sensor/water_meter_wifi_signal_percentage/config&apos;, message: &apos;{&apos;unique_id&apos;: &apos;water_meter_wifi_signal_percentage&apos;, &apos;object_id&apos;: &apos;water_meter_wifi_signal_percentage&apos;, &apos;device_class&apos;: &apos;signal_strength&apos;, &apos;icon&apos;: &apos;mdi:wifi&apos;, &apos;unit_of_measurement&apos;: &apos;%&apos;, &apos;qos&apos;: &apos;0&apos;, &apos;state_topic&apos;: &apos;everblu/cyble/wifi_signal_percentage&apos;, &apos;force_update&apos;: &apos;true&apos;, &apos;entity_category&apos;: &apos;diagnostic&apos;, &apos;device&apos;: {&apos;identifiers&apos;: [&apos;14071984&apos;], &apos;model&apos;: &apos;Itron EverBlu Cyble Enhanced Water Meter ESP8266/ESP32&apos;, &apos;manufacturer&apos;: &apos;Psykokwak [Forked by Genestealer]&apos;, &apos;support_url&apos;: &apos;https://github.com/genestealer/everblu-meters-esp8266-improved&apos;, &apos;suggested_area&apos;: &apos;Home&apos;, &apos;name&apos;: &apos;Water Meter&apos;}, &apos;name&apos;: &apos;WiFi Signal&apos;}&apos;
    Error &apos;extra keys not allowed @ data[&apos;device&apos;][&apos;support_url&apos;]&apos; when processing MQTT discovery message topic: &apos;homeassistant/sensor/water_meter_value/config&apos;, message: &apos;{&apos;unique_id&apos;: &apos;water_meter_value&apos;, &apos;object_id&apos;: &apos;water_meter_value&apos;, &apos;icon&apos;: &apos;mdi:water&apos;, &apos;unit_of_measurement&apos;: &apos;L&apos;, &apos;device_class&apos;: &apos;water&apos;, &apos;state_class&apos;: &apos;total_increasing&apos;, &apos;qos&apos;: 0, &apos;state_topic&apos;: &apos;everblu/cyble/liters&apos;, &apos;force_update&apos;: True, &apos;device&apos;: {&apos;identifiers&apos;: [&apos;14071984&apos;], &apos;model&apos;: &apos;Itron EverBlu Cyble Enhanced Water Meter ESP8266/ESP32&apos;, &apos;manufacturer&apos;: &apos;Psykokwak [Forked by Genestealer]&apos;, &apos;support_url&apos;: &apos;https://github.com/genestealer/everblu-meters-esp8266-improved&apos;, &apos;suggested_area&apos;: &apos;Home&apos;, &apos;name&apos;: &apos;Water Meter&apos;}, &apos;name&apos;: &apos;Reading (Total)&apos;}&apos;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As you can see there are some errors regarding the &lt;code class=&quot;language-text&quot;&gt;support_url&lt;/code&gt; field. Removing this invalid field in the schema (and some other minor tweaks) in the PR resolved the issue and the device became available in HA! üéâ&lt;/p&gt;
&lt;h1&gt;Result! What‚Äôs next?&lt;/h1&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 331px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f48391176a4c0e875aafd6da75247d83/62452/water-meter-ha.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 116.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAIAAACEf/j0AAAACXBIWXMAAA7CAAAOwgEVKEqAAAACnUlEQVQ4y41U7W7iMBDkFXqJk107sTEhX0AaTBqOFMJHWwGNwlXVPUD/3fs/wl3iQilUp44cS5Y93tnNeDuEEESkn4HfACGkQykVQiCi3QIAENH9BiilHdM0l8vl29vb4XB4fX19eXmZz+cA4Lqu8180ZACIoqgo7ieTyWw2y7IsSRLHcfT156e/iNymCMQ0AJGYDQghAKBTYIydyDojvaVL0wGb9EdZlK8pWGOlNptNURSr1Wq9Xs/ncyml5ruuu16v8zzXu+PxGAA6CHY3GPQGiiKEYZim6Wg0StN0PB4rpU5kx3Fub2/jOE6SRCmVJElDppQxBGoT1+W2bRuGYZqmfcSXsg3D0Mo7QIwwWyWb37Z5Myvu67ouy7LX62mp1wXjnFdVlee5ZVkdtK1enPrpjILtB8GghRDiPOYFP47jfr+PiE21HUYZRcd1T0UGgC+ZJ29pU3Zs82ZYHrLDHwRLqcluvy/L8vn5OQiC5t4zTKfTx8fHsix3u12WZbZtN9WWwdAbZYxSKaXv+1LKIAg45xeRhRC+73ueF8ex53lH2c5HetrYiHgtmzGmvcEYe3cYWMRPZ6PlL4pYFEVd19ohVVUppS6U63uTJDnKRuTSE1540uY4Dm+ho108Bo0Pb7d3Nie73S7nXAjBOZdS6uWJyTn3PE9K6Xke57zJufV2Hs+2YJlFa5Kqqh4eHhaLRV3XURTpKlBKoyja7/dPT0/b7TaO49aeiC4Xbrenc2o+zkVXNmJc7nw2mc5Cz++y29cJnNFmOIwz5MflxRvmZ9Dkxls4vKPhiIYJDRMcTjCZ4kDhMHO4OP+Rl52kiSy6mK3YcEKHGd7+RDXHu1Uzq4UrpHvVQz46ie4baP5AizSDmEiM0wB4t/o1/nXPvwaRss4Vqq6OAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;A screenshot of the water meter in Home Assistant&quot;
        title=&quot;A screenshot of the water meter in Home Assistant&quot;
        src=&quot;/static/f48391176a4c0e875aafd6da75247d83/62452/water-meter-ha.png&quot;
        srcset=&quot;/static/f48391176a4c0e875aafd6da75247d83/c26ae/water-meter-ha.png 158w,
/static/f48391176a4c0e875aafd6da75247d83/6bdcf/water-meter-ha.png 315w,
/static/f48391176a4c0e875aafd6da75247d83/62452/water-meter-ha.png 331w&quot;
        sizes=&quot;(max-width: 331px) 100vw, 331px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Now I just need to tidy up those wires and 3D print a tidy little case to hide it away in the pantry.&lt;/p&gt;
&lt;p&gt;You can find my &lt;a href=&quot;https://github.com/AdrianLThomas/everblu-meters-esp8266-improved&quot;&gt;fork here&lt;/a&gt; or if you prefer to view the diff see the &lt;a href=&quot;https://github.com/genestealer/everblu-meters-esp8266-improved/pull/3&quot;&gt;PR to the maintainer here&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Running Postgres 100% in the browser with PGlite and Drizzle]]></title><description><![CDATA[tl;dr I‚Äôve been playing around with PGlite (Postgres WASM), and it‚Äôs pretty cool. There are some gotchas, so I‚Äôll run through how I got‚Ä¶]]></description><link>https://www.adrian-thomas.com/blog/2025-03-11/running-postgres-in-the-browser/</link><guid isPermaLink="false">https://www.adrian-thomas.com/blog/2025-03-11/running-postgres-in-the-browser/</guid><pubDate>Tue, 11 Mar 2025 00:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;tl;dr&lt;/h1&gt;
&lt;p&gt;I‚Äôve been playing around with &lt;a href=&quot;https://pglite.dev/&quot;&gt;PGlite&lt;/a&gt; (&lt;a href=&quot;https://www.postgresql.org/&quot;&gt;Postgres&lt;/a&gt; &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/WebAssembly&quot;&gt;WASM&lt;/a&gt;), and it‚Äôs pretty cool. There are some gotchas, so I‚Äôll run through how I got PGlite running with &lt;a href=&quot;https://vite.dev/&quot;&gt;Vite&lt;/a&gt; (React) and &lt;a href=&quot;https://orm.drizzle.team/&quot;&gt;Drizzle&lt;/a&gt; (ORM). There‚Äôs a working &lt;a href=&quot;http://www.adrian-thomas.com/pglite-spa&quot;&gt;demo&lt;/a&gt; and &lt;a href=&quot;https://github.com/AdrianLThomas/pglite-spa&quot;&gt;GitHub repo&lt;/a&gt; at the end too.&lt;/p&gt;
&lt;h1&gt;Getting setup&lt;/h1&gt;
&lt;p&gt;Run the Vite scaffolder with your favourite package manager (I‚Äôll continue to use Bun, but feel free to use npm/yarn/pnpm etc)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;bun create vite&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and follow the steps to create a new React project.&lt;/p&gt;
&lt;p&gt;You can then add PGlite:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;bun &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; @electric-sql/pglite&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Gotcha #1 - Exclude PGlite from the bundle&lt;/h2&gt;
&lt;p&gt;Some bundlers (like Vite and Next.js) struggle with PGlite, and it will error with something like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Uncaught Error: Invalid FS bundle size: 723 !== 5401749&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;so &lt;a href=&quot;https://pglite.dev/docs/bundler-support#vite&quot;&gt;exclude it from optimisation&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// vite.config.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; defineConfig &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;vite&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; react &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;@vitejs/plugin-react&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;defineConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  plugins&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;react&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  optimizeDeps&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    exclude&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;@electric-sql/pglite&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;PGlite 101&lt;/h2&gt;
&lt;p&gt;We‚Äôre now in a position to make a Postgres query!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/// App.tsx&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; useEffect &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;react&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; PGlite &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;@electric-sql/pglite&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; drizzle &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;drizzle-orm/pglite&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;App&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;useEffect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; client &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;PGlite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;idb://my-pgdata&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; db &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;drizzle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; client &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;select 1;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sql&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; sql &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Markup omitted for brevity...&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;p&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; App&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We‚Äôre using &lt;code class=&quot;language-text&quot;&gt;idb://my-pgdata&lt;/code&gt; when instantiating the client to use persistent browser storage. However there are also &lt;a href=&quot;https://pglite.dev/docs/filesystems#filesystems&quot;&gt;other storage options&lt;/a&gt; available.&lt;/p&gt;
&lt;h2&gt;Types, schema &amp;#x26; migrations with Drizzle&lt;/h2&gt;
&lt;p&gt;You can probably skip this part if you don‚Äôt want / need to use an ORM and are happy with arbitrary SQL. However if you‚Äôd like types and the ability to migrate between schemas, please continue‚Ä¶&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;bun &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; drizzle-orm &lt;span class=&quot;token comment&quot;&gt;# Lets us define the schema and gives us types&lt;/span&gt;
bun &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; -d drizzle-kit &lt;span class=&quot;token comment&quot;&gt;# Helpful for migrations&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;You can then &lt;a href=&quot;https://orm.drizzle.team/docs/sql-schema-declaration&quot;&gt;create a schema with Drizzle&lt;/a&gt;. For this example let‚Äôs just create a simple TODO table:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/// src/app/db/schema.ts&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    pgTable&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    serial&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    varchar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token builtin&quot;&gt;boolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    timestamp&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;drizzle-orm/pg-core&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
  &lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; todos &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pgTable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;todos&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    id&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;serial&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;primaryKey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    content&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;content&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; length&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;notNull&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    completed&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;boolean&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;completed&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    createdAt&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;timestamp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;created_at&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;defaultNow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Drizzle will provide us with some nice types based on this.&lt;/p&gt;
&lt;h2&gt;Gotcha #2 - How do you run migrations in the browser?&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://orm.drizzle.team/docs/get-started/pglite-new&quot;&gt;PGlite / Drizzle get started guide&lt;/a&gt; is great, but it assumes you‚Äôre running PGlite on the server. Thus there are some differences (and unfortunately an undocumented API we need to use..).&lt;/p&gt;
&lt;p&gt;Create a Drizzle config file:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Config &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;drizzle-kit&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  schema&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./src/app/db/schema.ts&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  out&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./src/app/db/migrations&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  dialect&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;postgresql&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  driver&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;pglite&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; satisfies Config&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Generate the migration:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;npx drizzle-kit generate &lt;span class=&quot;token comment&quot;&gt;# generates the SQL files to perform a migration&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Ordinarily you would now run &lt;code class=&quot;language-text&quot;&gt;npx drizzle-kit migrate&lt;/code&gt;, HOWEVER: you‚Äôre not on the server, you‚Äôre on the client! so this is never going to work. How do you run the migration in the browser?&lt;/p&gt;
&lt;h3&gt;Compile offline migrations&lt;/h3&gt;
&lt;p&gt;Thankfully I came across a very &lt;a href=&quot;https://github.com/drizzle-team/drizzle-orm/discussions/2532&quot;&gt;helpful post on GitHub&lt;/a&gt; by &lt;a href=&quot;https://github.com/daltonkyemiller&quot;&gt;@daltonkyemiller&lt;/a&gt;. They found an undocumented API that where we can take our generated SQL migration and convert it in to the JSON format required to run it against PGlite.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// You could execute this standalone script with Bun like so:&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// drizzle-kit generate &amp;amp;&amp;amp; bun ./src/app/db/compile-migrations.ts&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; readMigrationFiles &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;drizzle-orm/migrator&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; path &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;path&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; migrationsFolder &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./src/app/db/migrations&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; migrations &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;readMigrationFiles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; migrationsFolder &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; Bun&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;cwd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;migrationsFolder&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/migrations.json&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token constant&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stringify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;migrations&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token builtin&quot;&gt;console&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Migrations compiled!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We now have a &lt;code class=&quot;language-text&quot;&gt;migrations.json&lt;/code&gt; file that can be used in the browser.&lt;/p&gt;
&lt;p&gt;üö® &lt;em&gt;Unfortunately, as the functions are undocumented, the Drizzle team could break them any point in time. Unfortunately if you want to use Drizzle in the browser then there is no alternative at the time of writing.&lt;/em&gt;&lt;/p&gt;
&lt;h3&gt;Executing the migration&lt;/h3&gt;
&lt;p&gt;Setup the migration:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/// src/app/db/migrate.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; MigrationConfig &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;drizzle-orm/migrator&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; db &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./drizzle&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; migrations &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./migrations/migrations.json&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;migrate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// @ts-ignore&lt;/span&gt;
  db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dialect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;migrate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;migrations&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;session&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    migrationsTable&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;drizzle_migrations&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; satisfies Omit&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;MigrationConfig&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;migrationsFolder&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;and simply execute the exported &lt;code class=&quot;language-text&quot;&gt;migrate&lt;/code&gt; function, e.g.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// root.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; migrate &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./migrate&quot;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;migrate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;renderApp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I‚Äôve provided an example repo at the end of this post showing how I executed the migration wrapped in &lt;a href=&quot;https://react.dev/reference/react/Suspense&quot;&gt;Suspense&lt;/a&gt; so that a placeholder is shown during initialisation.&lt;/p&gt;
&lt;h1&gt;Basic CRUD operations&lt;/h1&gt;
&lt;p&gt;It‚Äôs just Drizzle all the way forward now, there‚Äôs a bunch of &lt;a href=&quot;https://orm.drizzle.team/docs/rqb&quot;&gt;documentation&lt;/a&gt;, but here‚Äôs some examples sticking with the TODO theme:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/// src/app/db/actions.ts&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fetchAllTodos&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;todos&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;orderBy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;todos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;createdAt&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;addTodoAction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;formData&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; FormData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; todo&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;typeof&lt;/span&gt; todos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;$inferInsert &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    content&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; formData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;content&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; inserted &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;insert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;todos&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;todo&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;returning&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; inserted&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;deleteTodoAction&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;formData&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; FormData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; id &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;parseInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;formData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; deleted &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; db&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;todos&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;eq&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;todos&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;id&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; id&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;returning&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; deleted&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;Getting data in and out&lt;/h1&gt;
&lt;p&gt;There‚Äôs a number of options depending on what the use-case is, but I‚Äôll describe an approach I took. If you just want test data, you can use &lt;a href=&quot;https://orm.drizzle.team/docs/seed-overview&quot;&gt;drizzle-seed&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;CSV Import&lt;/h2&gt;
&lt;p&gt;One option to import data is with a CSV. Given it‚Äôs running in the browser, you need to be able to obtain the CSV as a blob. This is then mapped to &lt;a href=&quot;https://pglite.dev/docs/api#dev-blob&quot;&gt;PGlite‚Äôs virtual device&lt;/a&gt; &lt;code class=&quot;language-text&quot;&gt;/dev/blob&lt;/code&gt;, and then you can just copy the data like you ordinarily would with SQL:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;typescript&quot;&gt;&lt;pre class=&quot;language-typescript&quot;&gt;&lt;code class=&quot;language-typescript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// example depicting the copying of citizen data from a CSV in to the citizens table.&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; csvResponse &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/smart_city_citizen_activity.csv&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;
  COPY citizens(id, age, gender, mode_of_transport)
  FROM &apos;/dev/blob&apos;
  DELIMITER &apos;,&apos;
  CSV HEADER;
  &lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  blob&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; csvResponse&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;blob&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;If you‚Äôre storing your data in IndexedDB then you‚Äôll also want to query if the data has already been imported before doing so (to avoid doing so on each load!).&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;Import/Export alternative with PGlite&lt;/h2&gt;
&lt;p&gt;PGlite also supports exporting to a tarball with &lt;a href=&quot;https://pglite.dev/docs/api#dumpdatadir&quot;&gt;dumpDataDir&lt;/a&gt;, and importing with &lt;a href=&quot;https://pglite.dev/docs/api#options&quot;&gt;loadDataDir&lt;/a&gt;. Here‚Äôs an &lt;a href=&quot;https://pglite.dev/examples/dump-data-dir&quot;&gt;(example of both)&lt;/a&gt;&lt;/p&gt;
&lt;h1&gt;SQL Client&lt;/h1&gt;
&lt;p&gt;You might be tempted to reach for your favourite Postgres client (and/or Drizzle Studio). Unfortunately you cannot use it (there‚Äôs no endpoint to connect to!).&lt;/p&gt;
&lt;p&gt;One option would be to export and re-import elsewhere to a server Postgres instance.&lt;/p&gt;
&lt;p&gt;However, there is a REPL that PGlite provides that let‚Äôs you query directly in the browser. It‚Äôs just a &lt;a href=&quot;https://pglite.dev/docs/repl&quot;&gt;React component (web component also available)&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;tsx&quot;&gt;&lt;pre class=&quot;language-tsx&quot;&gt;&lt;code class=&quot;language-tsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; Repl &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;@electric-sql/pglite-repl&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;

&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Repl&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;pg&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There‚Äôs even a &lt;a href=&quot;https://pglite.dev/repl/&quot;&gt;live demo of the REPL here&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;Gotcha #3 - You‚Äôre at the mercy of dependencies&lt;/h3&gt;
&lt;p&gt;When I was setting up what seemed to be a simple React component for the REPL, I got an error:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Uncaught Error: No CodeMirror editor found&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I raised an &lt;a href=&quot;https://github.com/electric-sql/pglite/issues/559&quot;&gt;issue on GitHub&lt;/a&gt; and &lt;a href=&quot;https://github.com/ldirer&quot;&gt;@ldirer&lt;/a&gt; found out it‚Äôs related to a change in the CodeMirror dependency itself.&lt;/p&gt;
&lt;p&gt;If you‚Äôre seeing this issue, the workaround at the time of writing is to override to an older version of React CodeMirror:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;  &lt;span class=&quot;token property&quot;&gt;&quot;overrides&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;@uiw/react-codemirror&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;4.23.5&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;Code &amp;#x26; Demo&lt;/h1&gt;
&lt;p&gt;The repo with the &lt;a href=&quot;https://github.com/AdrianLThomas/pglite-spa&quot;&gt;code can be found here&lt;/a&gt;: it shows most things discussed in this post.&lt;/p&gt;
&lt;p&gt;You can also see a &lt;a href=&quot;http://www.adrian-thomas.com/pglite-spa&quot;&gt;live demo of the working code here&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Thanks for reading!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Writing user focused tickets that enable continuous flow]]></title><description><![CDATA[When writing software, it‚Äôs important to understand who it is for and what it will achieve. Ensuring the ticket is clear and understood by‚Ä¶]]></description><link>https://www.adrian-thomas.com/blog/2022-09-27/writing-user-focused-tickets/</link><guid isPermaLink="false">https://www.adrian-thomas.com/blog/2022-09-27/writing-user-focused-tickets/</guid><pubDate>Tue, 27 Sep 2022 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;When writing software, it‚Äôs important to understand who it is for and what it will achieve. Ensuring the ticket is clear and understood by those around us ensures we don‚Äôt waste precious time. My favourite approach to this is focusing on the end user from the frontend, and working towards the backend.&lt;/p&gt;
&lt;p&gt;Occasionally I‚Äôll see a ticket like this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Write an API endpoint that does X thing to the database, it should return a 200 if ok otherwise 400&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The biggest problem is it lacks context. Why are we doing this? Who is it for? What should it look like? How do I know if I‚Äôve finished it?&lt;/p&gt;
&lt;p&gt;The problem is a bit like declarative vs imperative programming: describing the desired state for what we want vs how to implement it. I see the following as the core parts of a ticket to make it ‚Äòdeclarative‚Äô:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The User Story
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;As a receptionist, I want to compose emails, so that I can make appointments with customers&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;It has 3 parts: the actor, the narrative and the goal&lt;/li&gt;
&lt;li&gt;It sets the context and describes the requirement&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Acceptance Criteria
&lt;ul&gt;
&lt;li&gt;A bullet pointed list that you could prefix with ‚Äúdone when‚Äù to describe the behaviour, not the implementation&lt;/li&gt;
&lt;li&gt;e.g.: &lt;em&gt;Done When&lt;/em&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;A recipient email address can be specified&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;A subject can be specified&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;A message body can be specified&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;The email is sent to the recipient&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;em&gt;You may also notice that each of these bullet points can be copied verbatim and used for a UI test!&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Optional but recommended: Wireframes to describe roughly what the UX could look and feel like, or to describe the user‚Äôs workflow. Pictures speak 1000 words, but there‚Äôs a fine line to walk in order to not dictate implementation detail. Use wireframes to describe the goal and not the solution. They enable collaboration with everyone: developers, designers, product, users and stakeholders&lt;/li&gt;
&lt;li&gt;Optional: Supporting links, architectural diagrams, prior art / investigations.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The above doesn‚Äôt describe exactly how it should be implemented, just what the expected outcomes are. This provides flexibility and allows you to have conversations to arrive at the best solution, and make those decisions as late as possible (perhaps after further research).&lt;/p&gt;
&lt;p&gt;If your team is responsible for different areas of development then you can write task tickets for those specific tasks that relate to the user story.&lt;/p&gt;
&lt;p&gt;Now, everyone has the context, the shared goal and knows when they can say the goal is accomplished. At minimum it‚Äôs clear what the ticket actually means and what needs to be achieved.&lt;/p&gt;
&lt;p&gt;By writing tickets this way it enables you to deliver cohesive features continuously, rather than in batches to your users.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9c3e15bd1d5f0e3d240fd61f93543522/5c684/continuous-flow.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAADEklEQVQozyXP22tbdQDA8VPaNKEm64WtTFu3MqFzBRFx003wMrzgQApi91JlMnxyZeKmS5Oe8ztpkiZNliVNu6VJK5qatjRxydJL0uQkJzm9oAgqgs6nIYgo+OSjguj5yvQf+MBHapdLZrdPY2hmx3w02uRwsM5gtMmJmMHA9Sad3hqdokinuolF1OkNNhmM7nI8tsMjEYMj1w36Q4bZITSscvUvyaqUeHWhaZ6cbdAXqDGa2efodI3Hojrnl/Y44KnSJTawi00O+WuMpPcZmNZ5MKBzOKDzcsrg7PwONrlidiga0rM36yY/Finm4uY7KztwL4M7lWJe24fvEwzH1rDK27S5N4iU9uCHj7icyiC5GzwcqPPrdxq/NePmYLBCu1IzpWPTVe7kk1xcyHN6RqN25ybPzJS5sFCkkJ/neKRB72SJdrnEG/NbbBfmODOrYRM1enwNFtfSRJaX6A0YdChVpJaJMkNTK3R7tpBcFZ4IrtIqa3Qq6zwZyGATOkcD2zjEFpK7ykOTRWxqg57JGm1ynW5lgy5PGcdkA4fQkF4MLUDuOW5//C5j8TDkTiMnvKRSH0D+aS7OJLApVSxyBdctP3/nnuf95A1axB79vk2+To9yL/s6Q6ENLLKOdGp6iV/yw0SSLkZit/g9f46341HGk35++myYF8JpujwV2uQKzoSfP3IvcTkRpUXs/gd+ufwWd1fOcyK0Qft9UJLr2F3rWCaqSG6DHlcBaUJHcuk4xou0qgYDgfL/ZbnOoLKEY7JO9/2yaHJILnBErGH3GjhEFekp7ydmPe3EOT9rvuZPsptxciG+wKXwDYyVcc7FsxxQy1jlMm+G5ribvYI7OUerukOvvM6niypfrF4zT4XztMm6KY2FpuCbq2Y25SIRvwbfOomFnejZcfj8PUZ9MaxyBctEmcicgK+cJBJeWtQ9jk2s8vP2h/ypXeXs1JLZKppIB0XBHAv7edyzbPaL21wJ+elTCpz0pbkUnKZT3qJLlLCrJQ4qRUZ8Efo8RexqDYuic0Zd5BVvwnxA1OgQ2j//AqQMIMQ0K7jTAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;a diagram of pizza being made in stages - batches vs continuous flow&quot;
        title=&quot;Continuous Flow&quot;
        src=&quot;/static/9c3e15bd1d5f0e3d240fd61f93543522/f058b/continuous-flow.png&quot;
        srcset=&quot;/static/9c3e15bd1d5f0e3d240fd61f93543522/c26ae/continuous-flow.png 158w,
/static/9c3e15bd1d5f0e3d240fd61f93543522/6bdcf/continuous-flow.png 315w,
/static/9c3e15bd1d5f0e3d240fd61f93543522/f058b/continuous-flow.png 630w,
/static/9c3e15bd1d5f0e3d240fd61f93543522/40601/continuous-flow.png 945w,
/static/9c3e15bd1d5f0e3d240fd61f93543522/78612/continuous-flow.png 1260w,
/static/9c3e15bd1d5f0e3d240fd61f93543522/5c684/continuous-flow.png 1829w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Source: &lt;a href=&quot;https://kanbanize.com/continuous-flow&quot;&gt;Kanbanize.com&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1&gt;Further Reading&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;Writing user stories: &lt;a href=&quot;https://www.gov.uk/service-manual/agile-delivery/writing-user-stories&quot;&gt;https://www.gov.uk/service-manual/agile-delivery/writing-user-stories&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Writing acceptance criteria: &lt;a href=&quot;https://technology.blog.gov.uk/2015/03/04/creating-better-acceptance-criteria-for-user-stories/&quot;&gt;https://technology.blog.gov.uk/2015/03/04/creating-better-acceptance-criteria-for-user-stories/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Wireframing with Balsamiq: &lt;a href=&quot;https://balsamiq.com/tutorials/articles/firstwireframe&quot;&gt;https://balsamiq.com/tutorials/articles/firstwireframe&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[Running curl in BusyBox]]></title><description><![CDATA[curl doesn‚Äôt exist in BusyBox by default, but there is a way to do it - and it‚Äôs simpler than you may think! BusyBox is an executable that‚Ä¶]]></description><link>https://www.adrian-thomas.com/blog/2021-12-24/running-curl-in-busybox/</link><guid isPermaLink="false">https://www.adrian-thomas.com/blog/2021-12-24/running-curl-in-busybox/</guid><pubDate>Fri, 24 Dec 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;curl doesn‚Äôt exist in BusyBox by default, but there is a way to do it - and it‚Äôs simpler than you may think!&lt;/p&gt;
&lt;p&gt;BusyBox is an executable that typically gets used in low powered devices like routers, it gives you basic commands like &lt;code class=&quot;language-text&quot;&gt;cd&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;ls&lt;/code&gt; but if you want to &lt;code class=&quot;language-text&quot;&gt;curl&lt;/code&gt; something from the internet (e.g. HTTP POST): you can‚Äôt. There‚Äôs no package manager, and it‚Äôs very awkward to do manually with netcat / raw TCP.&lt;/p&gt;
&lt;p&gt;You do have wget, so you can HTTP GET‚Ä¶ a pre-built curl binary!&lt;/p&gt;
&lt;p&gt;First, find out what CPU architecture you‚Äôre on:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ arch
x86_64&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here we‚Äôre running 64bit x86, but you may be running ARM or some other architecture. Head to &lt;a href=&quot;https://curl.se/download.html&quot;&gt;curl.se&lt;/a&gt; and pick the &lt;em&gt;binary&lt;/em&gt; for your flavour. It‚Äôll take you to the GitHub page to download it: copy the URL for your binary.&lt;/p&gt;
&lt;p&gt;Then simply wget the url! don‚Äôt forget to make it executable&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; https://github.com/moparisthebest/static-curl/releases/download/v7.80.0/curl-amd64
&lt;span class=&quot;token function&quot;&gt;chmod&lt;/span&gt; +x ./curl-amd64
./curl-amd64 -X POST --insecure https://ptsv2.com/t/57y8r-1640280329/post&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note: As CA certificates aren‚Äôt installed either, I needed to pass the &lt;code class=&quot;language-text&quot;&gt;--insecure&lt;/code&gt; flag. Ideally you should &lt;a href=&quot;https://stackoverflow.com/questions/45388934/how-do-i-make-an-https-call-in-a-busybox-docker-container-running-go&quot;&gt;make them available&lt;/a&gt; to BusyBox.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Hacking an Asus router to run regular shell scripts on boot]]></title><description><![CDATA[Asus routers let you SSH in to them for remote management. In this post you‚Äôll learn how to run a shell command to run any scripts you want‚Ä¶]]></description><link>https://www.adrian-thomas.com/blog/2021-12-23/hacking-an-asus-router-to-run-shell-scripts/</link><guid isPermaLink="false">https://www.adrian-thomas.com/blog/2021-12-23/hacking-an-asus-router-to-run-shell-scripts/</guid><pubDate>Thu, 23 Dec 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Asus routers let you SSH in to them for remote management. In this post you‚Äôll learn how to run a shell command to run any scripts you want (e.g. routine backup scripts).&lt;/p&gt;
&lt;p&gt;I wanted to backup some files on an external disk attached to the router, and store them in DropBox. It‚Äôs possible by SSH‚Äôing in to the router, writing the script to flash memory (so it isn‚Äôt erased on reboot), and configuring it to run when a USB device is connected.&lt;/p&gt;
&lt;p&gt;First, navigate to your router admin page, go to the Administration Settings and enable login via SSH. It will look something like this:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c9339882218731f4c604e160f46e4d77/ffe34/router-ssh-config.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.34177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADDElEQVQ4y12SS2/iVhiGzSbRVGpVddFFMrtKHY2Gi7kZsI2NjS9gsHECmGObY2yDb8eAmUmAhkx/Qpf9vy2kjTIjPYuzefS+3/cdrEDQvNxnBSmPV7oDzU2z8WKpmnAI5ka49XYHM9mCeGP+D4jWcPOF7mu3nwiM4CR9Bgb3kxbDcX3VSTZ3tiuPQVebmPF6vn2YhmgWoWmYvjAJkIkysqfe5gmsISrKaNSiyFKl/BGvVtqd30vVD+X6b4WSOLWMJFMsqwcm/MTkLnTGQDBsnBXeFxoYBzPvz7/h8S8BPkqje3e9023vDvr63IPpLnh8slFmJlsL/YeZbN3dY1sZ3ZxrK0BxNoKxxNkBIyuTxZLX7nltzA50I0DB8Xm5fwqPX1eH59X+5D38AVA2jTcteXiuXedlSel1+E6xXPpUrZNijxZ7dYb/gNckwxoHiRGlRryZBEj3w/tVMoS+aDrljniu/eMvv15dXV+/++Hq+rpINGlZITpCje0WCFJzlt7j0wxlAO1ml0AjyYaLlQL9Ki+/zzewdz/9jGEYlsthGFaoN5nesEyxxVa7QJCq7QKU3flR33ZfkQDsQ7/KSd/LeJPih3qF7uAUW2xQirUAKDMjX4W2BBzZPCOZziX5rYyd5XyN4AYaJfSKTepjlZAMZxxluhuM3EACUDBswbC7U0u2nMrLzC9y7pLcVXUn3U28QIe+ai5stIW7o5VmJtq+ApINzB5o5fLD3sp8VzLnnqhovYEu9zXbi9z13lolMy8EfvTCzAthmDLi4Hyqt7Vb5RrTEYoVokKQxXJdB9DffB6CuWJYr/SnpgZgu83fFr5dGEm0mL5a6wglis03ac2B1joewpnqgNFipjrnxwCC/tylWeGNfPFreLXFyzWGL11OpQBoxDsjQPfLZBKgaYCmIRqvklmU8l355rttN8p1WlJwksVJptCg7hw/Op7C/Sk+fo0Op/h4ig/P0eE53j/JonLzzcy5XLNc63Jiq0lTJNMgyJm1SHf7JI2DOHYD5IepFyI3SJZRynHSv8n/AFcyG1qmONNYAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Router SSH Config&quot;
        title=&quot;Router SSH Config&quot;
        src=&quot;/static/c9339882218731f4c604e160f46e4d77/f058b/router-ssh-config.png&quot;
        srcset=&quot;/static/c9339882218731f4c604e160f46e4d77/c26ae/router-ssh-config.png 158w,
/static/c9339882218731f4c604e160f46e4d77/6bdcf/router-ssh-config.png 315w,
/static/c9339882218731f4c604e160f46e4d77/f058b/router-ssh-config.png 630w,
/static/c9339882218731f4c604e160f46e4d77/40601/router-ssh-config.png 945w,
/static/c9339882218731f4c604e160f46e4d77/ffe34/router-ssh-config.png 1055w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Then SSH in to it. The router is running BusyBox which is a very lightweight Linux executable used for embedded systems. It gives you some very basic utilities [1] (sorry, don‚Äôt even expect nano!).&lt;/p&gt;
&lt;p&gt;The filesystem is running in RAM, which obviously resets on reboot. However, if we write to the &lt;code class=&quot;language-text&quot;&gt;/jffs&lt;/code&gt; path, it will be written to flash memory - this is perfect to persist a script that could run on boot.&lt;/p&gt;
&lt;p&gt;There is one problem, if this is the only area we can persist data, how do we actually run a script on boot? Well, we can write to NVRAM (non-volatile RAM). NVRAM is stores key/value pairs, such as your WiFi password, public SSH keys, SSID, etc. but we can use it to set a small command that runs when a USB device is mounted (e.g. on boot) [2].&lt;/p&gt;
&lt;p&gt;Here are some of the WiFi settings if you grep the &lt;code class=&quot;language-text&quot;&gt;nvram show&lt;/code&gt; command:
&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/58ff8f9c60640f2213a39ba1900802d9/0d6fe/wifi-settings.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 32.278481012658226%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAyElEQVQY03XJwWqEMBQF0JAELcYsJiLWjRhkJublaf/L6iL9BWlHwY8eSBhx07O43Hcfef79btu27/txHOu6eu9/3rz336d5DjEvyzKHPk0TaZpGa911XVmWUsosyz6CNE2TJKGUcs4ZY9fCGOOcU0oJAHwFAGCMsdb2fQ8A1loAcM4hYizDMDjn4o6IWmtirUXEc42MMY/gHmitjTH3t7jXdU0QcRzHtm2rqvoMlFJCiOwf50sIQYqiuF0opaSUeZ7Li3heM5YXHFM3vDbeEO8AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;nvram show&quot;
        title=&quot;nvram show&quot;
        src=&quot;/static/58ff8f9c60640f2213a39ba1900802d9/f058b/wifi-settings.png&quot;
        srcset=&quot;/static/58ff8f9c60640f2213a39ba1900802d9/c26ae/wifi-settings.png 158w,
/static/58ff8f9c60640f2213a39ba1900802d9/6bdcf/wifi-settings.png 315w,
/static/58ff8f9c60640f2213a39ba1900802d9/f058b/wifi-settings.png 630w,
/static/58ff8f9c60640f2213a39ba1900802d9/40601/wifi-settings.png 945w,
/static/58ff8f9c60640f2213a39ba1900802d9/0d6fe/wifi-settings.png 1115w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The magic parameter we want to set is &lt;code class=&quot;language-text&quot;&gt;script_usbmount&lt;/code&gt; to run a command when a USB device is mounted.&lt;/p&gt;
&lt;p&gt;So, putting it altogether, this is what it would look like:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; /jffs &lt;span class=&quot;token comment&quot;&gt;# Change directory to flash memory&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;#!/bin/sh&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; ./my-script.sh &lt;span class=&quot;token comment&quot;&gt;# Append shell shebang to .my-script.sh in flash memory&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;while :; do echo &quot;do something&quot;; sleep 86400; done&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; ./my-script.sh &lt;span class=&quot;token comment&quot;&gt;# append command&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;chmod&lt;/span&gt; +x ./my-script.sh &lt;span class=&quot;token comment&quot;&gt;# make the script executable&lt;/span&gt;
nvram &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;script_usbmount&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sh /jffs/my-script.sh&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# set the parameter to execute when a USB device is mounted&lt;/span&gt;
nvram commit &lt;span class=&quot;token comment&quot;&gt;# commit the parameter to non-volatile memory&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reboot&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# reboot the router&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I‚Äôm using echo with output redirection to write to a file called &lt;code class=&quot;language-text&quot;&gt;my-script.sh&lt;/code&gt;. I‚Äôm terrible with Vim (which &lt;em&gt;is&lt;/em&gt; available) so this works well enough for me, but feel free to use Vim if you‚Äôre comfortable with it. I‚Äôve excluded the actual backup script as that‚Äôs worthy of an entire blog post. In a nutshell, when a usb device is mounted the command in &lt;code class=&quot;language-text&quot;&gt;script_usbmount&lt;/code&gt; is executed.  It indefinitely loops, and echo‚Äôs &lt;code class=&quot;language-text&quot;&gt;&quot;do something&quot;&lt;/code&gt; then sleeps for 24 hours (&lt;code class=&quot;language-text&quot;&gt;86400&lt;/code&gt;s). Obviously this script could contain any code you wanted to reasonably run.&lt;/p&gt;
&lt;p&gt;That‚Äôs it!&lt;/p&gt;
&lt;p&gt;Sources:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.busybox.net/downloads/BusyBox.html#commands&quot;&gt;https://www.busybox.net/downloads/BusyBox.html#commands&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.snbforums.com/threads/how-to-run-cron-and-other-scripts-on-startup.69063/#post-648945&quot;&gt;https://www.snbforums.com/threads/how-to-run-cron-and-other-scripts-on-startup.69063/#post-648945&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[Golang for the Node Guy]]></title><description><![CDATA[This was an original piece I wrote for DAZN‚Äôs internal blog earlier in the year, that I‚Äôve adapted for a public audience. In our team we‚Ä¶]]></description><link>https://www.adrian-thomas.com/blog/2021-10-30/golang-for-the-node-guy/</link><guid isPermaLink="false">https://www.adrian-thomas.com/blog/2021-10-30/golang-for-the-node-guy/</guid><pubDate>Sat, 30 Oct 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1c8b04aa30b14371c785b989efa15dec/00d43/gophernode.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD50lEQVQ4y22U7U9adxTH+y/szV7uxV50WUzd0kXnQ1uf2miYTqFzWNeHSRzZdN1ao85mE4dataioo9qhUagPULzoBa3aDnyIxVKwqVoHAqIooHh5KktFuJd7728RdcV2Jyf5neTkk3PO95dzToBII0mSIABJgneNJA+zEXYCABDC8WAwGNjbQzGMAAALhfy7r30uBLGYt016h9ngcyEhHA/hOE6QgUAgGAxiGHYEh0J+v58EYGNpXnHvzlhTpbiM0cnI7LiczvvmAi//vKCIPsZljTVXWnWLGEHs7e29gTEMQ0P4ytxUN5PalPlZc05cY04ih3amnnrudvaZakpMRXpMNSWmMSu2PS/FqJ5BcQINBvdhMjzhhn6Zn5/Kyz3b8FUq71Ia52JSPS2ZnZnAykmpLWb+lJ74CyWhkZ7WnP05zCo+aDZcOQx381rocVG0+Oi0Tz7Kjj31RVx0UtSHBRnJlazbjOKSjPjTydEnMz6Nyo49RT93Wjr4YHd3903befSLSR9/UHuzWNhRDw3wdAsLhZe/ZpaxKu7cTU8/r9U+Uykfcaq/ZVLimVcuJSbEbtlt+zARVl8k6r+eR3Ws6uWrucL5OADAiGxEOK6WaS31jZz9uf5RcGffg6cYGpW2oa4GAEAQxCEMw9LqajYAoFeb0qI4CQA6JIWZpawbbO6vVVUAgDW3omny/RWfcF6z0NH+BwAAx/HDmVeNBuqXlPU1Cwq8AQLxvw4UXMmjZV64WVSQlZGqVCoAAH5sBwBQV1sjlw0fVj6QDkPRiopyak5WeUnJrbLya1fzrxZ+z6n7/S63rvy3Khot5+frP1SUln5XWMBgXPN6PTiOHwpGEKTP6x6QP+4ZV7f2wVyBtHtkdliz3glNNPH7BudMgzMveZJHbQOjXfInXZJRj9uF48QRTJIet7MHeghr1uXPrfIX2/D8BjT9AlaqIcVTycxS58hcm0DCl4zLn1vviWQuJ3Kg1BHsQgTQQ4nKxBfc7+nm90FwDbvqbHxMLi37VknRUxHb8bhuuPXG/b8W+A9GXcjO27BwaKJ/cglq/nEdrlQJyqWD4mWdXqfTj48OD3XVSrqb2loaxNMvO0Qjzv+BpeOQaqXlzx5Bby8ED9vsNse2fcu+iXh8UwsW0fSyeNYg066198ucyDttd4nl4idGSG3WrrmXba/WHF6z1WG276xsIovrO8pFS//kkmTO1CqUHq9MEL5X3kmVRmPceqbbMFoRk81psDpNNpfR6jJYneYt99+WHbV+U2vanphRez0RX4XjoUAgsL+XYUfRIIoG99+I4L8shqHHjkHkFSLDK/qWH8tGHKl/AXO9kOzAxBNhAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Gophernode&quot;
        title=&quot;Gophernode&quot;
        src=&quot;/static/1c8b04aa30b14371c785b989efa15dec/f058b/gophernode.png&quot;
        srcset=&quot;/static/1c8b04aa30b14371c785b989efa15dec/c26ae/gophernode.png 158w,
/static/1c8b04aa30b14371c785b989efa15dec/6bdcf/gophernode.png 315w,
/static/1c8b04aa30b14371c785b989efa15dec/f058b/gophernode.png 630w,
/static/1c8b04aa30b14371c785b989efa15dec/40601/gophernode.png 945w,
/static/1c8b04aa30b14371c785b989efa15dec/00d43/gophernode.png 1000w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;This was an original piece I wrote for DAZN‚Äôs internal blog earlier in the year, that I‚Äôve adapted for a public audience.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;In our team we recently created a small new API in Go, to provide editorial teams a more reliable search experience when curating content. In this post, I wanted to share some experiences from starting afresh with Go, through the lens of doing Node.js development.&lt;/p&gt;
&lt;p&gt;I‚Äôm not advocating to take what you do in Node and take the same approach in Go, but to simply explain the concepts against something you already know and how they are different.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;You‚Äôll get to read my opinions about:
&lt;ul&gt;
&lt;li&gt;Why Go?&lt;/li&gt;
&lt;li&gt;Go vs Node: Building, linting and testing&lt;/li&gt;
&lt;li&gt;Dealing with private modules&lt;/li&gt;
&lt;li&gt;Learning materials&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;I won‚Äôt be writing about
&lt;ul&gt;
&lt;li&gt;How to setup your dev environment&lt;/li&gt;
&lt;li&gt;How to build your first http server, etc etc (lots of other blog posts and content are available online for this)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Why Go?&lt;/h2&gt;
&lt;p&gt;The &lt;a href=&quot;https://golang.org/AUTHORS&quot; target=&quot;_blank&quot;&gt;Go Authors&lt;/a&gt; set out a set of values for the language:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Thoughtful&lt;/li&gt;
&lt;li&gt;Simple&lt;/li&gt;
&lt;li&gt;Efficient&lt;/li&gt;
&lt;li&gt;Reliable&lt;/li&gt;
&lt;li&gt;Productive&lt;/li&gt;
&lt;li&gt;Friendly&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Which I feel is a really human way to describe a technical topic like a programming language, and it also resonates throughout the Go community itself, and is documented in the &lt;a href=&quot;https://golang.org/conduct&quot; target=&quot;_blank&quot;&gt;Code of Conduct&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I love that Go is easy to read, has a tiny footprint (a SCRATCH Docker image is around 2mb, not far off the native binary) and can run almost anywhere: X86, ARM, MIPS, PPC, RISC-V, s390x, Web Assembly and there‚Äôs even a microcontroller version for the Arduino (TinyGo).&lt;/p&gt;
&lt;p&gt;Go is really geared up for smaller applications, like CLI‚Äôs, microservices and API‚Äôs and it also has a great concurrency model if your application needs to do heavier crunching.&lt;/p&gt;
&lt;p&gt;Here‚Äôs an example of Go‚Äôs simplicity, of how you can add a method to an existing float64 type in Go:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; MyFloat &lt;span class=&quot;token builtin&quot;&gt;float64&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m MyFloat&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Abs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;float64&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   f &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;float64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; f &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;f
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; f
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
f &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;MyFloat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Abs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// == 42.0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Anyone who can write code, will be able to read this and see what it‚Äôs doing.&lt;/p&gt;
&lt;h2&gt;Go vs Node&lt;/h2&gt;
&lt;p&gt;In this section I‚Äôll be explaining Go workflow fundamentals through the lens of a Node.js developer.&lt;/p&gt;
&lt;h3&gt;Building&lt;/h3&gt;
&lt;p&gt;Running and building code in Node.js and Go is simple:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Run a node app:&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;node&lt;/span&gt; ./app.js

&lt;span class=&quot;token comment&quot;&gt;# Run a go app:&lt;/span&gt;
go run main.go

&lt;span class=&quot;token comment&quot;&gt;# or build a native binary&lt;/span&gt;
go build -o my-app main.go

&lt;span class=&quot;token comment&quot;&gt;# and execute it&lt;/span&gt;
./my-app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;When you build a Go binary, the Go runtime (garbage collection, scheduler, etc) is bundled in to the executable ‚Äì this means any consumers of your app do not require the Go runtime to be installed (unlike Java, .NET and even Node.js).&lt;/p&gt;
&lt;h3&gt;Hot Restart&lt;/h3&gt;
&lt;p&gt;When developing your application, you may want to make small changes and see them immediately (for example, an API endpoint or changing HTML markup). In Node.js, you will have seen this kind of behaviour with &lt;code class=&quot;language-text&quot;&gt;nodemon&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;jest --watch&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;webpack&lt;/code&gt; etc.&lt;/p&gt;
&lt;p&gt;Unfortunately for Go, this requires a full rebuild, as unlike script based languages, the executable code can‚Äôt just be ‚Äòswapped‚Äô out (like you would see with a hot reload).&lt;/p&gt;
&lt;p&gt;Fortunately, Go does build quickly ‚Äì and there are tools out there to give us hot restart behaviour. &lt;a href=&quot;https://github.com/gravityblast/fresh&quot; target=&quot;_blank&quot;&gt;Fresh&lt;/a&gt; is the one we have been using in our team, but &lt;a href=&quot;https://github.com/cespare/reflex&quot; target=&quot;_blank&quot;&gt;Reflex&lt;/a&gt; is another option.&lt;/p&gt;
&lt;h3&gt;REPL&lt;/h3&gt;
&lt;p&gt;Node.js‚Äôs REPL (Read Eval Print Loop) is a great tool for trying out language features, inbuilt functions and other experimentation.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;node&lt;/span&gt; 
Welcome to Node.js v15.11.0.
Type &lt;span class=&quot;token string&quot;&gt;&quot;.help&quot;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;more&lt;/span&gt; information.
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; console.log&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;hello world&apos;&lt;/span&gt;.toUpperCase&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;))&lt;/span&gt;
HELLO WORLD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There‚Äôs not a Go equivalent, but there is &lt;a href=&quot;https://play.golang.org/&quot; target=&quot;_blank&quot;&gt;The Go Playground&lt;/a&gt; that has pretty much the same behaviour.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/3c34e08d8444b0b75bc9f0099eaa262f/aec65/go-playground.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 53.79746835443038%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABfUlEQVQoz5WRXWvbMBSG9bt7NUY3erG7QW9Wtt4UCvsHuxiMEro2ndPEiefPuGm2NVlpmthyQmJbz5Bip0thrBU8vEfvkY6OJNF0rjnvDfja6dO4DDmzY6zglteHbV4eWOy+b7F3aLGzf86rDy1evLM4/uQTDkbY3hC3f0M8krw5snn7sYcY3IQEV47BjToMRxG/7oY02t85uXQMjbbD54uu8b5YPZw4Ypr85HZyzWT2g6kcc2q7NB0PsVh0mU6/obUoXCAGQqD/iPivOKrW1BpscmK59Mhzn8XCYTxukiQ2ZRkain+gc0pFW9R7xGrlURQBee6xXLro+frk//O4qEbM5w5Z1mUyaXF/30JK28zTtGPi2axNknRIU+33TE77SoVV0XDrEJHnwSZRFL7pVD/BWj3T8foWfuX7Jtbd1F1uFXww+tUDP5UApYLqQx4QSTJCyt9oVUoC0uhTqNdqrRFSzsmyOWmasVrlKIUZtT53CKUUNWVZGgW10efyB/8FP7HF37SeAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;The Go Playground&quot;
        title=&quot;The Go Playground&quot;
        src=&quot;/static/3c34e08d8444b0b75bc9f0099eaa262f/f058b/go-playground.png&quot;
        srcset=&quot;/static/3c34e08d8444b0b75bc9f0099eaa262f/c26ae/go-playground.png 158w,
/static/3c34e08d8444b0b75bc9f0099eaa262f/6bdcf/go-playground.png 315w,
/static/3c34e08d8444b0b75bc9f0099eaa262f/f058b/go-playground.png 630w,
/static/3c34e08d8444b0b75bc9f0099eaa262f/aec65/go-playground.png 687w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;Installing Packages&lt;/h3&gt;
&lt;p&gt;Introducing packages in Go is very similar to Node:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# node&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; express --save

&lt;span class=&quot;token comment&quot;&gt;# go&lt;/span&gt;
go get -u github.com/gorilla/mux&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Both commands will update the aforementioned package files, and you can then require/import the package and use it in your application.&lt;/p&gt;
&lt;p&gt;Node: &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;some-package&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1.0.0&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;description&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;main&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;index.js&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;echo \&quot;Error: no test specified\&quot; &amp;amp;&amp;amp; exit 1&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;author&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;license&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ISC&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;dependencies&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;express&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;^4.17.1&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;GO: &lt;code class=&quot;language-text&quot;&gt;go.mod&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;module github.com/privateorg/some-package
go 1.15
require github.com/gorilla/mux v1.8.0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Node: &lt;code class=&quot;language-text&quot;&gt;package-lock.json&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;some-package&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1.0.0&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;lockfileVersion&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;requires&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;dependencies&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;accepts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1.3.7&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;resolved&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://registry.npmjs.org/accepts/-/accepts-1.3.7.tgz&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;integrity&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;sha512-Il80Qs2WjYlJIBNzNkK6KYqlVMTbZLXgHx2oT0pU/fjRHyEp+PEfEPY0R3WCwAGVOtauxh1hOxNgIf5bv7dQpA==&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;requires&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;mime-types&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;~2.1.24&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Go: &lt;code class=&quot;language-text&quot;&gt;go.sum&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;github.com/gorilla/mux v1.8.0 h1:i40aqfkR1h2SlN9hojwV5ZA91wcXFOvkdNIeFDP5koI=
github.com/gorilla/mux v1.8.0/go.mod h1:DVbg23sWSpFRCP0SfiEN6jmj59UnW/n46BH5rLB71So=&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;They‚Äôre not exactly the same, but pretty similar.&lt;/p&gt;
&lt;h3&gt;Scripts&lt;/h3&gt;
&lt;p&gt;npm scripts are a great way to run common commands for testing, linting, building, etc, they are a way of self documenting how to interact with the codebase, for example in &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; you could have:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token property&quot;&gt;&quot;scripts&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token property&quot;&gt;&quot;build&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./build.sh&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;token property&quot;&gt;&quot;dev:&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;webpack-dev-server&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;token property&quot;&gt;&quot;lint&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./scripts/lint.sh&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;token property&quot;&gt;&quot;lint:fix&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./scripts/lint-fix.sh&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
   &lt;span class=&quot;token property&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;npx jest&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;then if you want to run the tests, just run &lt;code class=&quot;language-text&quot;&gt;npm test&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Go has some built in commands like &lt;code class=&quot;language-text&quot;&gt;go test&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;go build&lt;/code&gt;, but it doesn‚Äôt have an npm scripts equivalent. A typical ‚Äògo to‚Äô is &lt;code class=&quot;language-text&quot;&gt;Make&lt;/code&gt;; everyone has it installed already (but it can get ugly, quick, and you may fallback to shell scripts):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;makefile&quot;&gt;&lt;pre class=&quot;language-makefile&quot;&gt;&lt;code class=&quot;language-makefile&quot;&gt;&lt;span class=&quot;token target symbol&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
   go build -o my-app main.go
&lt;span class=&quot;token target symbol&quot;&gt;dev&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
   fresh
&lt;span class=&quot;token target symbol&quot;&gt;lint&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
   ./lint.sh
&lt;span class=&quot;token target symbol&quot;&gt;lint-fix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
   ./lint.sh --fix
&lt;span class=&quot;token target symbol&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
   go test ./...&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;but it does mean you can run common tasks simply, e.g. &lt;code class=&quot;language-text&quot;&gt;make build&lt;/code&gt; or &lt;code class=&quot;language-text&quot;&gt;make test&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;Linting&lt;/h3&gt;
&lt;p&gt;The Go compiler is pretty good at telling you off for certain things (e.g. importing a package that isn‚Äôt used). There‚Äôs also the &lt;code class=&quot;language-text&quot;&gt;go fmt&lt;/code&gt; command that will format your code nicely, and this even gets run automatically if you‚Äôre using Visual Studio Code.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4ac2a3dcc287c7c5887e10fbc7d61a24/2bef9/go-compiler.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAEcElEQVQ4y1WV2W7bVhCG/VR9jBYtkBdoUbQ3QfsCvc9FkZteFuhV2sRx7diyrNWyRFGyFlOUuIirRO12JFmS19ja/BWk0gQhMGeGxMHHwfxz5mw9PT2xWCxZr59Yr9cbv1rz9EQQPzzM+fDwyHK5Yj5fBHu/sPni03efteUHl5dXdDo9ut0+ntcJvGU5tNtdOt0L2u0LSobHcc0io7mkVeeTZfQGab1JVnEC6NZqteZ8cIFclZFlGVVVAyuVSsG74zqMh2PEepNYvUHS9EgYzY03PeKyTvSsRkpzg0yDDJ1Gm9FoxM3NDbe3G7u/u+X6aka/16fXPSfvAyWdrGKT0xzSskG23iKSzBANR8lozY/A5YqwUMUwOgz6I/R6i5rRomq0UL0BZbdHTnVpeANc26HjebQaDRzL5GY2ZTyaUJRtsprLow+cL5ds74qUSwZ3dx+4ub3nfDAmlpUJV00iqh1kJ5ktjiWddEUnUayRKmtkz1TOjAahrMJx1drU8HGxYGdXpOH2aZoek9GEQXdIqmJyYrWIay6FepNTw6+dR6SkM+iPubu+5yhR5KhikDSbnKgOcx/oU+PlOsmCSuQoR162yMkW4aJG2vIC4KnRpGS2iGgOf2UK/FGT2Ol5/BaJ8HdEIFVvkv5fFH9JyCb5skIimiddVoiXFKKCFMCimoPoQ602OwmBF6F3fL2/w7d7b/nh8B1/vt1jX5A40RufRclXDOSKTjZbpVhUqJxpZCSDrNYgXbOpWm0kq81hqkAkkmY7IbIbFdhJioQOjonka+T1xqaG/pJXHAp1j2Ld23jDI6+6CJJBoqBRUBxcb0Cz855Wb0S3NaDjDRhdTBgOZ4xHMwa9Icul39jrJ0pnVaSKjGHaKFqdmqJRNy3KFZmKomE1usym11xfX2HbNq7r0vSa2I5Nr9djsZgzmVyxWHxs7PKZTKVSYTDwj14TwzACa3seZr1Ov/+es6pFp9NlMpkwGo+4vLwM4tlsynQ6YTq5+ixKSrY4kUxSJQ1BMsnXHDKSSUFvIvgtozcRc2UymRylsozjtFA1E0U1UTULVTUoFuUNcLVe8zZ8SrXq8vDwyPXNPbc3dxT91pE3jV2w2ogZke3Xu4QPjgjvHbH/b4jwXohY6IjYQZhYJPlR5dWSf7YFXKfP/PGR2eQK/9HtDnHNIaG7lOwO0XiKN/tHiJLEL+kYz09ivBazfB8P81M0ROxEZOkDl+s1b/Zz6FqL88EItWYzHE7JSQZJ3Q2gZ06XN5EEv4cP+bWY5rmY5GcxyVfpEK8KeX5MRnhxmoXFaiPKcc0mXFA5CAkcfjxOMcUmZTSJqg4lt8vOdoh4OMqLgsB3qTDPTsJ8k9jneSbOs/A79ktFnuZLtuaPCxJlneOiwnHilIwgIah2IIagucHPJKuFUNKIZCUyhRovT7K8Sgpk06e8FDKECgVq5ermLPsjvnCqoNQcRLHG1dUtq9WX494f/2v/qliu8Pt2cffIRX/EcDjhdjRlNp4ynV0HV8B/vzd3/g+a8moAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Go Compiler&quot;
        title=&quot;go-compiler&quot;
        src=&quot;/static/4ac2a3dcc287c7c5887e10fbc7d61a24/f058b/go-compiler.png&quot;
        srcset=&quot;/static/4ac2a3dcc287c7c5887e10fbc7d61a24/c26ae/go-compiler.png 158w,
/static/4ac2a3dcc287c7c5887e10fbc7d61a24/6bdcf/go-compiler.png 315w,
/static/4ac2a3dcc287c7c5887e10fbc7d61a24/f058b/go-compiler.png 630w,
/static/4ac2a3dcc287c7c5887e10fbc7d61a24/40601/go-compiler.png 945w,
/static/4ac2a3dcc287c7c5887e10fbc7d61a24/2bef9/go-compiler.png 1024w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;However, if you‚Äôd like something more comprehensive, there are plenty of linting tools out there. The one we picked up in our team is &lt;a href=&quot;http://golangci-lint.run&quot; target=&quot;_blank&quot;&gt;golangci-lint&lt;/a&gt; as it has sensible defaults, easy to run (locally, Docker and even &lt;a href=&quot;https://github.com/marketplace/actions/run-golangci-lint&quot; target=&quot;_blank&quot;&gt;GitHub Actions&lt;/a&gt;).&lt;/p&gt;
&lt;h3&gt;Testing&lt;/h3&gt;
&lt;p&gt;Let‚Äôs take a look at a HTTP GET request for some users:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; axios &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;axios&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Users&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; axios&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/users.json&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;resp&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; resp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; Users&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;if we want to test this in Node.js, we may mock the request library and return a canned response:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; axios &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;axios&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Users &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;./users&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

jest&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;axios&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;should fetch users&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; users &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token literal-property property&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Bob&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; resp &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token literal-property property&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; users&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    axios&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;mockResolvedValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;resp&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Users&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;users&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;now let‚Äôs see what happens if we took the same approach in Go (using a request library called Resty):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Users &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   Name &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;`json:&quot;name&quot;`&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Users &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   resp&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; resty&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;New&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
       &lt;span class=&quot;token function&quot;&gt;SetResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Users&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
       &lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;https://example.com/users.json&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;resp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Users&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;In Go, we can‚Äôt mock the entire dependency at runtime. Go compiles to a native binary, so we can‚Äôt just swap out the loaded module at runtime like we do in Node.js.&lt;/p&gt;
&lt;p&gt;We need a different approach.&lt;/p&gt;
&lt;p&gt;Go has a testing framework built in, so strictly speaking we don‚Äôt need any external packages (though you may want to use a package like Testify to simplify boilerplates for spies, assertions, etc).&lt;/p&gt;
&lt;p&gt;Let‚Äôs write a test:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Test_All_ShouldFetchUsers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;testing&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;T&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   expectedUsers &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; Users&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Timmy&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Dylan&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
   actualUsers &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;DeepEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;expectedUsers&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; actualUsers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
       t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Errorf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Not the same, expected: %v, actual: %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; expectedUsers&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; actualUsers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Oh no, we just wrote a test that uses Resty to make a real HTTP request! If the data on the API changes, or the network is down ‚Äì our tests will fail! They‚Äôll also run slower than they should. This isn‚Äôt good.&lt;/p&gt;
&lt;p&gt;What we should be doing, is depending on an interface instead ‚Äì then we can inject any implementation we want.&lt;/p&gt;
&lt;p&gt;Let‚Äôs rewrite our code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token comment&quot;&gt;// client now created by consumer of all() &lt;/span&gt;
   client &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; resty&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;New&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
       &lt;span class=&quot;token function&quot;&gt;SetResult&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Users&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   users &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;client&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Users &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   Name &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;`json:&quot;name&quot;`&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Client &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token comment&quot;&gt;// same signature as Resty&apos;s get method&lt;/span&gt;
   &lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;resty&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// all now accepts the Client interface&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;client Client&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Users &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   resp&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; client&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;
              &lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;https://example.com/users.json&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   result &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; resp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Users&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;on lines 3-5, we create the Resty client and pass it in to &lt;code class=&quot;language-text&quot;&gt;all()&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;on line 18, we accept an interface &lt;code class=&quot;language-text&quot;&gt;Client&lt;/code&gt; (defined in line 14) ‚Äì it has the same signature as Resty‚Äôs &lt;code class=&quot;language-text&quot;&gt;Get&lt;/code&gt; function, thus Resty (a third party library) implements &lt;strong&gt;OUR&lt;/strong&gt; interface ‚Äì because interface implementation in Go is implicit&lt;/li&gt;
&lt;li&gt;on lines 19-20, we call the Get() function, just like we were before ‚Äì but using the passed in client&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;and here‚Äôs how we could have written the test:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; MockGetter &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token comment&quot;&gt;// Users internal to the mock&lt;/span&gt;
   mockUsers Users
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Method on our mock struct, but adhere&apos;s to Resty&apos;s Get() signature!&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;MockGetter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;resty&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Response&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token comment&quot;&gt;// Creating our own Resty request, with mock users&lt;/span&gt;
   request &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;resty&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Request&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Result&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mockUsers&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;resty&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Response&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Request&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; request&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Test_All_ShouldFetchUsers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;testing&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;T&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   expectedUsers &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; Users&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Timmy&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;Name&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Dylan&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
   mock &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;MockGetter&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;mockUsers&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; expectedUsers&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
   actualUsers &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;all&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mock&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;DeepEqual&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;expectedUsers&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; actualUsers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
       t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Errorf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Not the same, expected: %v, actual: %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; expectedUsers&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; actualUsers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;on line 15, we create an instance of the MockGetter (defined on line 1)&lt;/li&gt;
&lt;li&gt;because the &lt;code class=&quot;language-text&quot;&gt;MockGetter&lt;/code&gt; also implements the &lt;code class=&quot;language-text&quot;&gt;Client&lt;/code&gt; interface we defined (see &lt;code class=&quot;language-text&quot;&gt;Get()&lt;/code&gt; on line 7), we can simply pass in the mock to &lt;code class=&quot;language-text&quot;&gt;all()&lt;/code&gt; on line 17.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There are things we could further improve here, but I wanted to give an example close to the Node.js approach.&lt;/p&gt;
&lt;h3&gt;Deployment&lt;/h3&gt;
&lt;p&gt;In a nutshell, the Go compiler produces a native binary for the platform of your choice. The runtime is bundled in to the binary ‚Äì so you don‚Äôt need to worry about the target platform having your dependencies installed. For example, if you wanted to produce an ARM build for a Raspberry Pi, you target the ARM architecture and distribute the binary ‚Äì simple!&lt;/p&gt;
&lt;p&gt;This works great for CLI‚Äôs or API‚Äôs, and simple to run in Docker, AWS Lambda, etc too.&lt;/p&gt;
&lt;h2&gt;Private Modules&lt;/h2&gt;
&lt;p&gt;Go uses Git over HTTPS by default (&lt;a href=&quot;https://golang.org/doc/faq#git_https&quot; target=&quot;_blank&quot;&gt;documented here&lt;/a&gt;) for safety (safe default and developer experience with corporate firewalls). However it can cause problems when you reference a private repo, with not the most clear error messages:
&lt;code class=&quot;language-text&quot;&gt;go: github.com/myprivateorg/XYZ@v0.1.0: reading github.com/myprivateorg/XYZ/go.mod at revision v0.1.0: unknown revision v0.1.0&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;There‚Äôs a couple of things you can do. For local development, you can force usage of SSH (and your private key) by modifying your Git configuration:&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git config --global url.&quot;git@github.com:&quot;.insteadOf &quot;https://github.com/&quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Obviously for build pipelines this won‚Äôt work, and you may want to make use a token:
&lt;code class=&quot;language-text&quot;&gt;git config --global --add url.https://${GITHUB_TOKEN}@github.com/.insteadOf &quot;https://github.com&quot;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;Where &lt;code class=&quot;language-text&quot;&gt;${GITHUB_TOKEN}&lt;/code&gt; is your GitHub token with ‚Äòrepo‚Äô access. Obviously this will be slightly different if you use a different version control tool.&lt;/p&gt;
&lt;h2&gt;Learning Materials&lt;/h2&gt;
&lt;p&gt;To finish off, here are some handy resources you can use:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A Tour Of Go: &lt;a href=&quot;https://tour.golang.org/&quot; target=&quot;_blank&quot;&gt;tour.golang.org&lt;/a&gt; ‚Äì goes through the language and key idioms&lt;/li&gt;
&lt;li&gt;Go Playground:&lt;a href=&quot;https://play.golang.org/&quot; target=&quot;_blank&quot;&gt;play.golang.org&lt;/a&gt; ‚Äì like the Node.js REPL, but you can share snippets too&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://changelog.com/gotime&quot; target=&quot;_blank&quot;&gt;Go Time Podcast&lt;/a&gt; ‚Äì Great panel show that is easy to listen to&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;That‚Äôs all, feel free to tweet me &lt;code class=&quot;language-text&quot;&gt;@AdrianLThomas&lt;/code&gt; with any comments.&lt;/p&gt;
&lt;p&gt;Thanks for reading!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Making a Smart TV Dumber]]></title><description><![CDATA[I recently purchased a shiny new 4K Samsung TV. It‚Äôs brilliant, but it‚Äôs nearly impossible to buy one without ‚Äòsmart‚Äô capabilities (e.g‚Ä¶]]></description><link>https://www.adrian-thomas.com/blog/2021-10-04/marking-a-smart-tv-dumber/</link><guid isPermaLink="false">https://www.adrian-thomas.com/blog/2021-10-04/marking-a-smart-tv-dumber/</guid><pubDate>Mon, 04 Oct 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I recently purchased a shiny new 4K Samsung TV. It‚Äôs brilliant, but it‚Äôs nearly impossible to buy one without ‚Äòsmart‚Äô capabilities (e.g. Google Home, Alexa, Bixby, etc). There‚Äôs &lt;a href=&quot;https://www.kaspersky.co.uk/resource-center/threats/is-your-smart-tv-spying-on-you&quot; target=&quot;_blank&quot;&gt;plenty of security reasons why Smart TVs are bad&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;This post is how to make it a bit dumber (but not brain dead!). I like that I can use my TV for streaming movies over the local network, but I don‚Äôt care for having apps running on it (Netflix works just fine on the PS5 thanks!), so I wanted to block all outbound internet activity for it.&lt;/p&gt;
&lt;p&gt;In the end, this was quite simple. First, I ensured that the TV was assigned a static IP address. The easiest way for me to do this was from &lt;a href=&quot;https://pi-hole.net/&quot; target=&quot;_blank&quot;&gt;Pi-hole&lt;/a&gt; that I use as a DHCP server, and then assigned a static DHCP lease:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2f3f8a61314b4854eef3b59bbce3d347/eaf69/pihole-dhcp.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7CAAAOwgEVKEqAAAACcklEQVQ4y42UWXIlJxBFX7TX4J9ut4ZXBUUNFEUx1fAmWR0Ohzdge/8LOQ6QbEvqD/vjAplBXO4lEw5CCOpaMHQ1aVvo5wXjEnPcsHFlihsu7SWewoYNC5NfSs4vJ3zaUG2PqGuklBykEFRCMFU1q3O0k8PGE/vlidlHjHXMIWF9Im4XtvO1kJjZY6zHuIjqXgizuEMecqDGCe1XajVg0gW3XRn9QjcFWuNoBotdzizXb2i3MsyJIbuJO43qqP8mzDJz0GvDFFZkb7BpZ3/6Bb9dGeaIjXshsOlM2K+YsBbkKwj7Dana9wozYTeMhVBpy1g2PhUC7RZGvxZVU9zx24WwXcsho0u0xtO03RtCKUvQaUNvA6IbcWnjdL4QYmL24R84H/AhFuRYG4uZHar9YFm8WtZzoG6HYrPpNPdHwUPdcPdYc3eseaglX+6PBV8fa5y16Lz3ncJiuXohdAmlZyo1cDgc/hO/3yzr5UbX66KwtI14LUrb63JaO/4/wh8+feLPnz0mLC9FEW/bJqNpkf2EHCbSnFgnTxgmRtGihUJ/mK0aeI4LJ7fQqfbfOxRCvhCqjmaYCsI4c5Qtd3XDT481D7Lly2PN54eq5DLy+sevD/SiZWx7qneNLWqk6orCRlvmZkDcH+mbnuYoMf2IbjWqauhlh+kNnexQQnGZLVp1VN9ZflUoeoOPO7frM9t6IcWNJe4s6USKe4nXvA4bbo643LtvX8pHy/mljHFnWm9M6xWzZFww65Uxncts1lvJ63jC/fYHSk/UVYUoVX61/JawM740eZ5N/m3Cjp9XTs+/4vyG0Y7OhrIn/05NqXLmkfwF10XCTNU8p+kAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Pi-hole static IP address assignment&quot;
        title=&quot;Pi-hole static IP address assignment&quot;
        src=&quot;/static/2f3f8a61314b4854eef3b59bbce3d347/f058b/pihole-dhcp.png&quot;
        srcset=&quot;/static/2f3f8a61314b4854eef3b59bbce3d347/c26ae/pihole-dhcp.png 158w,
/static/2f3f8a61314b4854eef3b59bbce3d347/6bdcf/pihole-dhcp.png 315w,
/static/2f3f8a61314b4854eef3b59bbce3d347/f058b/pihole-dhcp.png 630w,
/static/2f3f8a61314b4854eef3b59bbce3d347/40601/pihole-dhcp.png 945w,
/static/2f3f8a61314b4854eef3b59bbce3d347/78612/pihole-dhcp.png 1260w,
/static/2f3f8a61314b4854eef3b59bbce3d347/eaf69/pihole-dhcp.png 1701w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Notice the IP address I set that will always be assigned to the MAC address (of the TV).&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Then in my router configuration I configured IPv4 port filtering to block all internet traffic. This is what it looks like on my Virgin Hub 3:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ac93f4a91fd2a3dfe4eb7a3ef4cba428/1ff84/virgin-ipfiltering.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 105.0632911392405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAIAAADJt1n/AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACVklEQVQ4y6WSzU4UQRDH5xWIIRgNRhJZVEiIhqOePHnQI/oAkPAcfGzUxV3Eg4kefAhOC49h4MIVzDJM73R3zfT0Z5WZ7V1YSTCiv1Qqne78uz6TZ7dmXk7cezr5YHaq0bhit+caU3Pz0wuL9xcf3nk0O9WYn15Ymnny4u7S84mFx5ON5MtG6/tm6/PWdrvZvmrrH9qb251me+ddp7PRam+0Os2Pu+8/fWvufl3v7Gy1E48Y6BpUSSBJcGLnVACxjPqsvhmRFFAAgFJKa+29D95747xxTltvHTqH2mBVofNoTDAGjcEQMGDwITHaAIAQAgAQkYgKBjLl/Ge/FIWxtkLSRIZqr63VI0IIiTVGSFGWJQ4hpPrf2hN6pfzBge92fbcb9ve9EJ4ohBC8R8REKQUAUBRa6xh5SDwD0Noara7SykrtT08vn4gSrXXMWSkVxWVZ9no9ADhP097ZGZeSC5H1+1zKNE2zjHHOGWMAkCBiVek62frHQc1FcXJyCkXBWJamqQTgXDDGpJSMMc4FFzzP87Iso1iFEC5y9t5b54YNGFSIiCGEmC0SevSDWJQQUZ7nEuCi2LoFUvIBYkCe5/HMOffeX86ZiFxROMZQVcPVqMqiAGOMH2GHOGvteFNrMQjB0tQbO0rbVVVljDHWmgG/TWGMWlwqpY0Zm1FdYSRGxvH5aU1VVVsIsWEVXqzIdcSn42NaXqa3b+j1K9rbq8Vu1Ns/iYf9UHR4SEdH9OMHZVmCIdhBVX8lvlLzzSLH/KMRJc65uNX/EtkaI6WMa3RjMf0HvwD+bXsjQkrg3gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Virgin Hub 3 IPv4 IP Filtering&quot;
        title=&quot;Virgin Hub 3 IPv4 IP Filtering&quot;
        src=&quot;/static/ac93f4a91fd2a3dfe4eb7a3ef4cba428/f058b/virgin-ipfiltering.png&quot;
        srcset=&quot;/static/ac93f4a91fd2a3dfe4eb7a3ef4cba428/c26ae/virgin-ipfiltering.png 158w,
/static/ac93f4a91fd2a3dfe4eb7a3ef4cba428/6bdcf/virgin-ipfiltering.png 315w,
/static/ac93f4a91fd2a3dfe4eb7a3ef4cba428/f058b/virgin-ipfiltering.png 630w,
/static/ac93f4a91fd2a3dfe4eb7a3ef4cba428/40601/virgin-ipfiltering.png 945w,
/static/ac93f4a91fd2a3dfe4eb7a3ef4cba428/1ff84/virgin-ipfiltering.png 1040w&quot;
        sizes=&quot;(max-width: 630px) 100vw, 630px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
        decoding=&quot;async&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The TV now has no in/outbound internet traffic, but it can still talk to the local network to serve up media. Perfect!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[The Beginning]]></title><description><![CDATA[Well, it‚Äôs been nearly 5 years since I last wrote any kind of personal blog. I‚Äôve written several posts for employers (a few pieces on‚Ä¶]]></description><link>https://www.adrian-thomas.com/blog/2021-09-06/the-beginning/</link><guid isPermaLink="false">https://www.adrian-thomas.com/blog/2021-09-06/the-beginning/</guid><pubDate>Mon, 06 Sep 2021 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Well, it‚Äôs been nearly &lt;a href=&quot;https://adrianlucathomas.blogspot.com/&quot;&gt;5 years&lt;/a&gt; since I last wrote any kind of personal blog. I‚Äôve written several posts for employers (a few pieces on NodeJS, Golang, GitHub Actions, etc.), but I finally got my act together and put something under my own domain. I‚Äôve been writing lots of React lately, and also Gatsby in my own time - so it felt like a good idea to start off with the &lt;a href=&quot;https://gatsbystarterblogsource.gatsbyjs.io/&quot;&gt;Gatsby Starter Blog&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;I introduced &lt;a href=&quot;https://styled-components.com/&quot;&gt;styled-components&lt;/a&gt; and &lt;a href=&quot;https://eslint.org/&quot;&gt;ESLint&lt;/a&gt; and put something basic together (that I plan to improve over time).&lt;/p&gt;
&lt;p&gt;I‚Äôm going to use this platform for trying out some new tooling (maybe take a look at the &lt;a href=&quot;https://github.com/AdrianLThomas/AdrianLThomas.github.io/issues&quot;&gt;issues here&lt;/a&gt; for a sneek peak), but I‚Äôll also write about my hobbies (see the header!).&lt;/p&gt;
&lt;p&gt;Also, because I‚Äôm a proper Yorkshireman - this blog runs on &lt;a href=&quot;https://pages.github.com/&quot;&gt;GitHub Pages&lt;/a&gt; for free, with the DNS &amp;#x26; CDN managed at &lt;a href=&quot;https://www.cloudflare.com/&quot;&gt;Cloudflare&lt;/a&gt; for free. I build this blog on &lt;a href=&quot;https://github.com/features/actions&quot;&gt;GitHub Actions&lt;/a&gt; for‚Ä¶ free. I suppose I do pay a few quid a year for the domain‚Ä¶&lt;/p&gt;
&lt;p&gt;That‚Äôs all for now!&lt;/p&gt;</content:encoded></item></channel></rss>